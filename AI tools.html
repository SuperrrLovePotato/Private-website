<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AIå¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿ - å¢å¼ºåˆ†å±ç‰ˆ</title>
  <style>
    :root {
      --bg: #071126;
      --card: #0b1622;
      --accent1: #7c3aed;
      --accent2: #06b6d4;
      --accent3: #10b981;
      --accent4: #f59e0b;
      --accent5: #ec4899;
      --warning: #f59e0b;
      --error: #ef4444;
      --muted: #9fb0c8;
      --text: #e6eef6;
      --border: rgba(255, 255, 255, 0.05);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Arial', sans-serif;
      background: linear-gradient(180deg, #030615, var(--bg));
      color: var(--text);
      line-height: 1.5;
      overflow: hidden;
    }
    
    #app {
      height: 100vh;
      display: flex;
      position: relative;
    }
    
    /* å·¦ä¾§æ§åˆ¶é¢æ¿ */
    .control-panel {
      width: 420px;
      min-width: 320px;
      display: flex;
      flex-direction: column;
      background: rgba(11, 22, 34, 0.95);
      border-right: 1px solid var(--border);
      z-index: 10;
      overflow-y: auto;
    }
    
    .panel-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: rgba(11, 22, 34, 0.95);
      z-index: 10;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    
    .panel-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .panel-left {
      display:flex;
      flex-direction:column;
    }

    .panel-right {
      display:flex;
      align-items:center;
      gap:8px;
    }
    
    .panel-title-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent2), var(--accent1));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: #021;
      font-size: 20px;
    }
    
    .panel-subtitle {
      color: var(--muted);
      font-size: 14px;
    }
    
    /* æŠ˜å é¢æ¿ */
    .collapsible-section {
      margin-bottom: 8px;
    }
    
    .section-header {
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.02);
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .section-header:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .section-title {
      font-weight: 600;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .section-icon {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      background: rgba(6, 182, 212, 0.1);
      color: var(--accent2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    .section-content {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: none;
    }
    
    .section-content.expanded {
      display: block;
      animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* AIé€‰æ‹©å™¨ */
    .ai-selector-container {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 5px;
    }
    
    .ai-selector-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .ai-option {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .ai-option:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--accent2);
      transform: translateY(-2px);
    }
    
    .ai-option.selected {
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(6, 182, 212, 0.08));
      border-color: var(--accent1);
    }
    
    .ai-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
      font-weight: 700;
      font-size: 14px;
    }
    
    .ai-name {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .ai-status {
      font-size: 10px;
      color: var(--muted);
    }
    
    /* åŠŸèƒ½æŒ‰é’® */
    .function-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .function-btn {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }
    
    .function-btn:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--accent2);
      transform: translateY(-2px);
    }
    
    .function-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .function-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .function-desc {
      font-size: 11px;
      color: var(--muted);
    }
    
    /* è¡¨å•å…ƒç´  */
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--muted);
    }
    
    .form-input, .form-textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--card);
      color: inherit;
      font-family: inherit;
      font-size: 14px;
    }
    
    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--accent2);
    }
    
    /* æŒ‰é’® */
    .btn {
      padding: 12px 20px;
      border-radius: 8px;
      border: 0;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
    }
    
    .btn-primary {
      background: linear-gradient(90deg, var(--accent2), var(--accent1));
      color: #021;
    }
    
    .btn-primary:hover {
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      color: var(--muted);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: var(--accent2);
      color: var(--text);
    }
    
    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
    }
    
    /* å³ä¾§æµè§ˆå™¨åŒºåŸŸ */
    .browser-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    
    .browser-header {
      padding: 16px 20px;
      background: rgba(11, 22, 34, 0.9);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .url-input {
      flex: 1;
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--card);
      color: inherit;
      font-family: inherit;
      font-size: 14px;
    }
    
    .url-input:focus {
      outline: none;
      border-color: var(--accent2);
    }
    
    .browser-controls {
      display: flex;
      gap: 8px;
    }
    
    .browser-btn {
      padding: 10px 16px;
      border-radius: 8px;
      border: 0;
      background: rgba(255, 255, 255, 0.05);
      color: var(--muted);
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
    }
    
    .browser-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
    }
    
    .browser-container {
      flex: 1;
      position: relative;
      background: #000;
    }
    
    .iframe-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    #aiFrame {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    /* åˆ†å±æ¨¡å¼ - å¢å¼ºç‰ˆ */
    .split-screen {
      display: flex;
      height: 100%;
      gap: 0;
      flex-wrap: nowrap;
      position: relative;
      overflow: hidden;
    }
    
    .split-panel {
      flex: 1;
      position: relative;
      display: flex;
      flex-direction: column;
      min-width: 200px;
      max-width: 100%;
    }
    
    .split-panel .iframe-container {
      position: relative;
      flex: 1;
      width: 100%;
      height: calc(100% - 48px);
    }
    
    /* åˆ†å±æ‹–æ‹½è°ƒæ•´å¤§å° */
    .split-resizer {
      width: 8px;
      background: rgba(6, 182, 212, 0.1);
      cursor: col-resize;
      position: relative;
      z-index: 10;
      transition: background 0.2s ease;
      flex-shrink: 0;
    }
    
    .split-resizer:hover, .split-resizer.resizing {
      background: rgba(6, 182, 212, 0.3);
    }
    
    .split-resizer::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 2px;
      height: 40px;
      background: var(--accent2);
      border-radius: 1px;
      opacity: 0.5;
    }
    
    /* åˆ†å±å¤´éƒ¨å¢å¼º */
    .split-header {
      padding: 8px 12px;
      background: rgba(11, 22, 34, 0.9);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 48px;
      flex-shrink: 0;
    }
    
    .split-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
      flex: 1;
    }
    
    .split-ai-selector {
      position: relative;
      min-width: 150px;
      margin-right: 8px;
    }
    
    .split-ai-select {
      width: 100%;
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--card);
      color: inherit;
      font-family: inherit;
      font-size: 12px;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239fb0c8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 8px center;
      background-size: 12px;
      padding-right: 28px;
    }
    
    .split-ai-select:focus {
      outline: none;
      border-color: var(--accent2);
    }
    
    .split-controls {
      display: flex;
      gap: 4px;
      align-items: center;
    }
    
    .split-control-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
      color: var(--muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.2s ease;
    }
    
    .split-control-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: var(--accent2);
      color: var(--text);
    }
    
    /* å°å±å¹•è‡ªé€‚åº” */
    @media (max-width: 900px) {
      #app { 
        flex-direction: column; 
        height: 100vh;
      }
      
      .control-panel { 
        width: 100%; 
        min-width: 100%; 
        max-height: 40vh;
      }
      
      .resize-handle { 
        display: none; 
      }
      
      .browser-panel { 
        width: 100%; 
        height: 60vh;
        flex: none;
      }
      
      .split-screen { 
        flex-direction: column; 
        height: 100%;
      }
      
      .split-panel { 
        width: 100% !important;
        height: 50% !important;
        min-width: 100%;
        min-height: 200px;
      }
      
      .split-resizer {
        width: 100%;
        height: 8px;
        cursor: row-resize;
      }
      
      .split-resizer::after {
        width: 40px;
        height: 2px;
      }
    }
    
    /* æ·»åŠ åˆ†å±æŒ‰é’®åŒºåŸŸ */
    .add-split-container {
      display: flex;
      justify-content: center;
      padding: 8px;
      background: rgba(11, 22, 34, 0.8);
      border-top: 1px solid var(--border);
    }
    
    .add-split-btn {
      padding: 8px 16px;
      border-radius: 8px;
      background: linear-gradient(90deg, var(--accent1), var(--accent5));
      color: white;
      border: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
    }
    
    .add-split-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
    }
    
    .add-split-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* åŠ è½½åŠ¨ç”» */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(6, 182, 212, 0.3);
      border-top-color: var(--accent2);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* å¯è°ƒèŠ‚åˆ†å‰²çº¿ */
    .resize-handle {
      width: 12px;
      cursor: col-resize;
      background: rgba(255, 255, 255, 0.02);
      position: relative;
      flex-shrink: 0;
      z-index: 30;
    }
    
    .resize-handle:hover {
      background: rgba(6, 182, 212, 0.12);
    }
    
    .resize-handle:active {
      background: rgba(6, 182, 212, 0.2);
    }
    
    .resize-handle::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 2px;
      height: 40px;
      background: rgba(6, 182, 212, 0.3);
      border-radius: 1px;
    }
    
    /* é€šçŸ¥ */
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      animation: slideIn 0.3s ease;
      max-width: 400px;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .notification.success {
      border-left: 4px solid var(--accent3);
    }
    
    .notification.warning {
      border-left: 4px solid var(--warning);
    }
    
    .notification.error {
      border-left: 4px solid var(--error);
    }
    
    /* æ¨¡æ€æ¡† */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      width: 90%;
      max-width: 500px;
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border);
      overflow: hidden;
    }
    
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-body {
      padding: 20px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .modal-footer {
      padding: 20px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    /* AIèŠå¤©å†å² */
    .chat-history {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 16px;
    }
    
    .chat-item {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.03);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    .chat-ai {
      font-weight: 600;
      color: var(--accent2);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .chat-time {
      font-size: 11px;
      color: var(--muted);
      margin-left: auto;
    }
    
    .chat-text {
      font-size: 12px;
      line-height: 1.4;
      color: var(--muted);
    }
    
    /* ä»£ç ç¼–è¾‘å™¨ */
    .code-editor {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 13px;
      line-height: 1.5;
      tab-size: 2;
    }
    
    /* ä»»åŠ¡åˆ—è¡¨ */
    .task-list {
      margin-top: 16px;
    }
    
    .task-item {
      display: flex;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
    }
    
    .task-checkbox {
      margin-right: 10px;
    }
    
    .task-text {
      flex: 1;
      font-size: 14px;
    }
    
    .task-completed {
      text-decoration: line-through;
      opacity: 0.6;
    }
    
    /* ç»Ÿè®¡å¡ç‰‡ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 16px;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 11px;
      color: var(--muted);
    }
    
    /* å¿«æ·é”®æç¤º */
    .shortcuts {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
    }
    
    .shortcut-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      font-size: 12px;
    }
    
    .shortcut-key {
      background: rgba(255, 255, 255, 0.05);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }
    
    /* è¿”å›æŒ‰é’® */
    .return-btn {
      position: static;
      margin-left: 12px;
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
      color: var(--muted);
      cursor: pointer;
      font-size: 14px;
      z-index: 100;
      transition: all 0.2s ease;
    }
    
    .return-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: var(--accent2);
      color: var(--text);
    }
    
    /* AIæœç´¢æ¡† */
    .ai-search {
      margin-bottom: 16px;
    }
    
    .search-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--card);
      color: inherit;
      font-family: inherit;
      font-size: 14px;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--accent2);
    }
    
    /* æ»šåŠ¨æ¡æ ·å¼ */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(6, 182, 212, 0.3);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(6, 182, 212, 0.5);
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
      <div class="panel-header">
          <div class="panel-left">
            <div class="panel-title">
              <div class="panel-title-icon">AI</div>
              <div>AIåä½œæ§åˆ¶ä¸­å¿ƒ</div>
            </div>
            <div class="panel-subtitle">å¤šAIé€‰æ‹©ã€æ™ºèƒ½åä½œã€ç¬”è®°è®°å½•ä¸æ›´å¤šåŠŸèƒ½</div>
          </div>
          <div class="panel-right">
            <button class="return-btn" id="returnMain">ğŸ  è¿”å›ä¸»é¡µ</button>
          </div>
        </div>
      
      <!-- AIé€‰æ‹©å™¨ -->
      <div class="collapsible-section">
        <div class="section-header" data-section="ai-selector">
          <div class="section-title">
            <div class="section-icon">ğŸ¤–</div>
            <span>AIé€‰æ‹©å™¨ (å·²é€‰æ‹©: <span id="selectedCount">1</span>)</span>
          </div>
          <div class="section-toggle">â–¼</div>
        </div>
        <div class="section-content" id="ai-selector-content">
          <div class="ai-search">
            <input type="text" id="aiSearch" class="search-input" placeholder="æœç´¢AI...">
          </div>
          
          <div class="ai-selector-container">
            <div class="ai-selector-grid" id="aiSelectorGrid">
              <!-- AIé€‰é¡¹ä¼šåŠ¨æ€ç”Ÿæˆ -->
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">è‡ªå®šä¹‰AI URLï¼š</label>
            <div class="btn-group">
              <input type="text" id="customAiUrl" class="form-input" placeholder="https://example.com" style="flex:1;">
              <button id="addCustomAi" class="btn btn-secondary btn-small">æ·»åŠ </button>
            </div>
          </div>
          
          <div class="btn-group">
            <button id="openSelectedAi" class="btn btn-primary" style="flex:1;">
              ğŸš€ æ‰“å¼€é€‰ä¸­çš„AI
            </button>
            <button id="multiOpenAi" class="btn btn-secondary">
              âš¡ å¤šå¼€
            </button>
          </div>
          
          <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button id="selectAllAi" class="btn btn-small btn-secondary" style="flex: 1;">å…¨é€‰</button>
            <button id="deselectAllAi" class="btn btn-small btn-secondary" style="flex: 1;">å…¨ä¸é€‰</button>
          </div>
        </div>
      </div>
      
      <!-- æ™ºèƒ½åŠŸèƒ½ -->
      <div class="collapsible-section">
        <div class="section-header" data-section="smart-functions">
          <div class="section-title">
            <div class="section-icon">âœ¨</div>
            <span>æ™ºèƒ½åŠŸèƒ½</span>
          </div>
          <div class="section-toggle">â–¼</div>
        </div>
        <div class="section-content" id="smart-functions-content">
          <div class="function-grid">
            <div class="function-btn" data-function="split-screen">
              <div class="function-icon">ğŸ–¥ï¸</div>
              <div class="function-title">åˆ†å±å¯¹æ¯”</div>
              <div class="function-desc">åŒæ—¶æŸ¥çœ‹å¤šä¸ªAIçš„å›ç­”</div>
            </div>
            
            <div class="function-btn" data-function="auto-query">
              <div class="function-icon">ğŸ¤–</div>
              <div class="function-title">è‡ªåŠ¨æé—®</div>
              <div class="function-desc">å‘æ‰€æœ‰AIå‘é€ç›¸åŒé—®é¢˜</div>
            </div>
            
            <div class="function-btn" data-function="answer-compare">
              <div class="function-icon">ğŸ“Š</div>
              <div class="function-title">ç­”æ¡ˆå¯¹æ¯”</div>
              <div class="function-desc">æ¯”è¾ƒä¸åŒAIçš„å›ç­”å·®å¼‚</div>
            </div>
            
            <div class="function-btn" data-function="ai-chat">
              <div class="function-icon">ğŸ’¬</div>
              <div class="function-title">AIå¯¹è¯</div>
              <div class="function-desc">æ¨¡æ‹ŸAIé—´çš„å¯¹è¯</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- é—®é¢˜è¾“å…¥ -->
      <div class="collapsible-section">
        <div class="section-header" data-section="question-input">
          <div class="section-title">
            <div class="section-icon">â“</div>
            <span>é—®é¢˜è¾“å…¥</span>
          </div>
          <div class="section-toggle">â–¼</div>
        </div>
        <div class="section-content" id="question-input-content">
          <div class="form-group">
            <label class="form-label">é—®é¢˜å†…å®¹ï¼š</label>
            <textarea id="questionInput" class="form-textarea" placeholder="è¾“å…¥æ‚¨æƒ³è¦å‘AIæé—®çš„é—®é¢˜...">äººå·¥æ™ºèƒ½åœ¨æœªæ¥åå¹´å†…ä¼šå¯¹ç¤¾ä¼šäº§ç”Ÿå“ªäº›é‡å¤§å½±å“ï¼Ÿ</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">é—®é¢˜é¢„è®¾ï¼š</label>
            <select id="questionPreset" class="form-input">
              <option value="">é€‰æ‹©é¢„è®¾é—®é¢˜...</option>
              <option value="è§£é‡Šé‡å­è®¡ç®—çš„åŸºæœ¬åŸç†">è§£é‡Šé‡å­è®¡ç®—çš„åŸºæœ¬åŸç†</option>
              <option value="å¦‚ä½•å­¦ä¹ ç¼–ç¨‹ï¼Ÿ">å¦‚ä½•å­¦ä¹ ç¼–ç¨‹ï¼Ÿ</option>
              <option value="å†™ä¸€é¦–å…³äºAIçš„è¯—æ­Œ">å†™ä¸€é¦–å…³äºAIçš„è¯—æ­Œ</option>
              <option value="åˆ¶å®šä¸€ä¸ªå¥èº«è®¡åˆ’">åˆ¶å®šä¸€ä¸ªå¥èº«è®¡åˆ’</option>
              <option value="å¦‚ä½•æŠ•èµ„ç†è´¢ï¼Ÿ">å¦‚ä½•æŠ•èµ„ç†è´¢ï¼Ÿ</option>
              <option value="è§£é‡ŠåŒºå—é“¾æŠ€æœ¯">è§£é‡ŠåŒºå—é“¾æŠ€æœ¯</option>
            </select>
          </div>
          
          <div class="btn-group">
            <button id="sendToAi" class="btn btn-primary" style="flex:1;">
              ğŸ“¤ å‘é€åˆ°AI
            </button>
            <button id="saveQuestion" class="btn btn-secondary">
              ğŸ’¾ ä¿å­˜
            </button>
          </div>
        </div>
      </div>
      
      <!-- ç¬”è®°ä¸è®°å½• -->
      <div class="collapsible-section">
        <div class="section-header" data-section="notes-records">
          <div class="section-title">
            <div class="section-icon">ğŸ“</div>
            <span>ç¬”è®°ä¸è®°å½•</span>
          </div>
          <div class="section-toggle">â–¼</div>
        </div>
        <div class="section-content" id="notes-records-content">
          <div class="form-group">
            <label class="form-label">ç¬”è®°æ ‡é¢˜ï¼š</label>
            <input type="text" id="noteTitle" class="form-input" placeholder="ç¬”è®°æ ‡é¢˜">
          </div>
          
          <div class="form-group">
            <label class="form-label">ç¬”è®°å†…å®¹ï¼š</label>
            <textarea id="noteContent" class="form-textarea" placeholder="è®°å½•æ‚¨çš„æƒ³æ³•æˆ–AIå›ç­”..."></textarea>
          </div>
          
          <div class="btn-group">
            <button id="saveNote" class="btn btn-primary" style="flex:1;">
              ğŸ’¾ ä¿å­˜ç¬”è®°
            </button>
            <button id="clearNotes" class="btn btn-secondary">
              ğŸ—‘ï¸ æ¸…ç©º
            </button>
          </div>
          
          <div class="chat-history" id="chatHistory">
            <!-- èŠå¤©å†å²ä¼šåŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
      </div>
      
      <!-- å·¥å…·ç®± -->
      <div class="collapsible-section">
        <div class="section-header" data-section="toolbox">
          <div class="section-title">
            <div class="section-icon">ğŸ§°</div>
            <span>å·¥å…·ç®±</span>
          </div>
          <div class="section-toggle">â–¼</div>
        </div>
        <div class="section-content" id="toolbox-content">
          <div class="function-grid">
            <div class="function-btn" data-function="code-editor">
              <div class="function-icon">ğŸ’»</div>
              <div class="function-title">ä»£ç ç¼–è¾‘å™¨</div>
              <div class="function-desc">ç¼–è¾‘å’Œè¿è¡Œä»£ç ç‰‡æ®µ</div>
            </div>
            
            <div class="function-btn" data-function="task-manager">
              <div class="function-icon">âœ…</div>
              <div class="function-title">ä»»åŠ¡ç®¡ç†</div>
              <div class="function-desc">è·Ÿè¸ªå’Œç®¡ç†ä»»åŠ¡</div>
            </div>
            
            <div class="function-btn" data-function="text-tools">
              <div class="function-icon">ğŸ“„</div>
              <div class="function-title">æ–‡æœ¬å·¥å…·</div>
              <div class="function-desc">å­—æ•°ç»Ÿè®¡ã€æ ¼å¼åŒ–ç­‰</div>
            </div>
            
            <div class="function-btn" data-function="quick-calc">
              <div class="function-icon">ğŸ§®</div>
              <div class="function-title">å¿«é€Ÿè®¡ç®—</div>
              <div class="function-desc">ç®€å•è®¡ç®—å’Œå•ä½è½¬æ¢</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <div class="collapsible-section">
        <div class="section-header" data-section="stats">
          <div class="section-title">
            <div class="section-icon">ğŸ“ˆ</div>
            <span>ç»Ÿè®¡ä¿¡æ¯</span>
          </div>
          <div class="section-toggle">â–¼</div>
        </div>
        <div class="section-content" id="stats-content">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="aiCount">0</div>
              <div class="stat-label">å¯ç”¨AI</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="queryCount">0</div>
              <div class="stat-label">æŸ¥è¯¢æ¬¡æ•°</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="noteCount">0</div>
              <div class="stat-label">ç¬”è®°æ•°é‡</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="sessionTime">0</div>
              <div class="stat-label">ä½¿ç”¨æ—¶é—´(åˆ†)</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- å¿«æ·é”®æç¤º -->
      <div class="collapsible-section">
        <div class="section-header" data-section="shortcuts">
          <div class="section-title">
            <div class="section-icon">âŒ¨ï¸</div>
            <span>å¿«æ·é”®</span>
          </div>
          <div class="section-toggle">â–¼</div>
        </div>
        <div class="section-content" id="shortcuts-content">
          <div class="shortcuts">
            <div class="shortcut-item">
              <span>å‘é€é—®é¢˜</span>
              <span class="shortcut-key">Ctrl + Enter</span>
            </div>
            <div class="shortcut-item">
              <span>æ–°å»ºç¬”è®°</span>
              <span class="shortcut-key">Ctrl + N</span>
            </div>
            <div class="shortcut-item">
              <span>åˆ‡æ¢åˆ†å±</span>
              <span class="shortcut-key">Ctrl + S</span>
            </div>
            <div class="shortcut-item">
              <span>è¿”å›ä¸»é¡µ</span>
              <span class="shortcut-key">Shift + Esc</span>
            </div>
            <div class="shortcut-item">
              <span>å…¨é€‰AI</span>
              <span class="shortcut-key">Ctrl + A</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- å¯è°ƒèŠ‚åˆ†å‰²çº¿ -->
    <div class="resize-handle" id="resizeHandle"></div>
    
    <!-- å³ä¾§æµè§ˆå™¨åŒºåŸŸ -->
    <div class="browser-panel">
      <div class="browser-header">
        <input type="text" id="urlInput" class="url-input" value="https://chat.deepseek.com" placeholder="è¾“å…¥AIç½‘ç«™URL">
        <div class="browser-controls">
          <button id="goBack" class="browser-btn" title="åé€€">
            <span>â†</span>
          </button>
          <button id="goForward" class="browser-btn" title="å‰è¿›">
            <span>â†’</span>
          </button>
          <button id="refreshPage" class="browser-btn" title="åˆ·æ–°">
            <span>â†»</span>
          </button>
          <button id="goHome" class="browser-btn" title="é¦–é¡µ">
            <span>ğŸ </span>
          </button>
          <button id="toggleSplit" class="browser-btn" title="åˆ†å±æ¨¡å¼">
            <span>ğŸ–¥ï¸</span>
          </button>
        </div>
      </div>
      
      <div class="browser-container" id="browserContainer">
        <!-- å•å±æ¨¡å¼ -->
        <div class="iframe-container" id="singleScreen">
          <iframe id="aiFrame" src="https://chat.deepseek.com"></iframe>
        </div>
        
        <!-- åˆ†å±æ¨¡å¼ - å¢å¼ºç‰ˆ -->
        <div class="split-screen" id="splitScreen" style="display: none;">
          <!-- åˆ†å±é¢æ¿ä¼šåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- åŠ è½½åŠ¨ç”» -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
          <div class="loading-spinner"></div>
          <div>æ­£åœ¨åŠ è½½AIç½‘ç«™...</div>
        </div>
      </div>
      
      <!-- æ·»åŠ åˆ†å±æŒ‰é’®åŒºåŸŸ -->
      <div class="add-split-container" id="addSplitContainer" style="display: none;">
        <button class="add-split-btn" id="addSplitBtn">
          <span>+</span> æ·»åŠ åˆ†å±é¢æ¿
        </button>
      </div>
    </div>
    
    <!-- æ¨¡æ€æ¡† -->
    <div class="modal" id="multiOpenModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>é€‰æ‹©è¦æ‰“å¼€çš„AIç½‘ç«™</h3>
          <button id="closeModal" style="background: none; border: none; color: var(--muted); cursor: pointer; font-size: 20px;">Ã—</button>
        </div>
        <div class="modal-body" id="modalAiList">
          <!-- é€‰é¡¹ä¼šåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="modal-footer">
          <button id="cancelMultiOpen" class="btn btn-secondary">å–æ¶ˆ</button>
          <button id="confirmMultiOpen" class="btn btn-primary">æ‰“å¼€é€‰ä¸­çš„ç½‘ç«™</button>
        </div>
      </div>
    </div>
    
    <!-- ä»£ç ç¼–è¾‘å™¨æ¨¡æ€æ¡† -->
    <div class="modal" id="codeEditorModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ä»£ç ç¼–è¾‘å™¨</h3>
          <button class="close-code-editor" style="background: none; border: none; color: var(--muted); cursor: pointer; font-size: 20px;">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">é€‰æ‹©è¯­è¨€ï¼š</label>
            <select id="codeLanguage" class="form-input">
              <option value="javascript">JavaScript</option>
              <option value="python">Python</option>
              <option value="html">HTML</option>
              <option value="css">CSS</option>
              <option value="java">Java</option>
              <option value="cpp">C++</option>
              <option value="php">PHP</option>
              <option value="sql">SQL</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">ä»£ç ï¼š</label>
            <textarea id="codeEditor" class="form-textarea code-editor" rows="15" placeholder="è¾“å…¥æ‚¨çš„ä»£ç ...">// JavaScriptç¤ºä¾‹
function helloWorld() {
  console.log("Hello, AI World!");
  return "ä»£ç æ‰§è¡ŒæˆåŠŸï¼";
}

// è°ƒç”¨å‡½æ•°
helloWorld();</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">æ‰§è¡Œç»“æœï¼š</label>
            <textarea id="codeOutput" class="form-textarea" rows="4" placeholder="æ‰§è¡Œç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button id="runCode" class="btn btn-primary">è¿è¡Œä»£ç </button>
          <button id="clearCode" class="btn btn-secondary">æ¸…ç©º</button>
          <button class="close-code-editor btn btn-secondary">å…³é—­</button>
        </div>
      </div>
    </div>
    
    <!-- ä»»åŠ¡ç®¡ç†å™¨æ¨¡æ€æ¡† -->
    <div class="modal" id="taskManagerModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ä»»åŠ¡ç®¡ç†å™¨</h3>
          <button class="close-task-manager" style="background: none; border: none; color: var(--muted); cursor: pointer; font-size: 20px;">Ã—</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">æ–°ä»»åŠ¡ï¼š</label>
            <div class="btn-group">
              <input type="text" id="newTaskInput" class="form-input" placeholder="è¾“å…¥æ–°ä»»åŠ¡...">
              <button id="addTask" class="btn btn-primary btn-small">æ·»åŠ </button>
            </div>
          </div>
          
          <div class="task-list" id="taskList">
            <!-- ä»»åŠ¡ä¼šåŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
        <div class="modal-footer">
          <button id="clearCompletedTasks" class="btn btn-secondary">æ¸…é™¤å·²å®Œæˆ</button>
          <button class="close-task-manager btn btn-secondary">å…³é—­</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // æ‰©å±•çš„AIç½‘ç«™é…ç½®
    const AI_WEBSITES = [
      { 
        id: 'deepseek', 
        name: 'DeepSeek', 
        url: 'https://chat.deepseek.com', 
        icon: 'ğŸ¤–', 
        color: '#1a73e8',
        status: 'åœ¨çº¿',
        category: 'é€šç”¨AI'
      },
      { 
        id: 'chatgpt', 
        name: 'ChatGPT', 
        url: 'https://chat.openai.com', 
        icon: 'âœ¨', 
        color: '#10a37f',
        status: 'åœ¨çº¿',
        category: 'é€šç”¨AI'
      },
      { 
        id: 'claude', 
        name: 'Claude', 
        url: 'https://claude.ai', 
        icon: 'ğŸ§ ', 
        color: '#d946ef',
        status: 'åœ¨çº¿',
        category: 'é€šç”¨AI'
      },
      { 
        id: 'gemini', 
        name: 'Gemini', 
        url: 'https://gemini.google.com', 
        icon: 'ğŸ”®', 
        color: '#ea4335',
        status: 'åœ¨çº¿',
        category: 'é€šç”¨AI'
      },
      { 
        id: 'wenxin', 
        name: 'æ–‡å¿ƒä¸€è¨€', 
        url: 'https://yiyan.baidu.com', 
        icon: 'ğŸŒ¸', 
        color: '#1890ff',
        status: 'åœ¨çº¿',
        category: 'ä¸­æ–‡AI'
      },
      { 
        id: 'tongyi', 
        name: 'é€šä¹‰åƒé—®', 
        url: 'https://tongyi.aliyun.com', 
        icon: 'ğŸŒŒ', 
        color: '#ff6b35',
        status: 'åœ¨çº¿',
        category: 'ä¸­æ–‡AI'
      },
      { 
        id: 'kimi', 
        name: 'Kimi', 
        url: 'https://kimi.moonshot.cn', 
        icon: 'ğŸŒ™', 
        color: '#8b5cf6',
        status: 'åœ¨çº¿',
        category: 'ä¸­æ–‡AI'
      },
      { 
        id: 'chatglm', 
        name: 'æ™ºè°±æ¸…è¨€', 
        url: 'https://chatglm.cn', 
        icon: 'ğŸ’¬', 
        color: '#10b981',
        status: 'åœ¨çº¿',
        category: 'ä¸­æ–‡AI'
      },
      { 
        id: 'spark', 
        name: 'è®¯é£æ˜Ÿç«', 
        url: 'https://xinghuo.xfyun.cn', 
        icon: 'ğŸ”¥', 
        color: '#f59e0b',
        status: 'åœ¨çº¿',
        category: 'ä¸­æ–‡AI'
      },
      { 
        id: 'hunyuan', 
        name: 'è…¾è®¯æ··å…ƒ', 
        url: 'https://hunyuan.tencent.com', 
        icon: 'â˜ï¸', 
        color: '#3b82f6',
        status: 'åœ¨çº¿',
        category: 'ä¸­æ–‡AI'
      },
      { 
        id: 'doubao', 
        name: 'è±†åŒ…', 
        url: 'https://www.doubao.com', 
        icon: 'ğŸ«˜', 
        color: '#ec4899',
        status: 'åœ¨çº¿',
        category: 'ä¸­æ–‡AI'
      },
      { 
        id: 'copilot', 
        name: 'Copilot', 
        url: 'https://copilot.microsoft.com', 
        icon: 'ğŸ¤', 
        color: '#047857',
        status: 'åœ¨çº¿',
        category: 'ç¼–ç¨‹AI'
      },
      { 
        id: 'phind', 
        name: 'Phind', 
        url: 'https://www.phind.com', 
        icon: 'ğŸ”', 
        color: '#3b82f6',
        status: 'åœ¨çº¿',
        category: 'ç¼–ç¨‹AI'
      },
      { 
        id: 'perplexity', 
        name: 'Perplexity', 
        url: 'https://www.perplexity.ai', 
        icon: 'ğŸ¤”', 
        color: '#10b981',
        status: 'åœ¨çº¿',
        category: 'ç ”ç©¶AI'
      },
      { 
        id: 'pi', 
        name: 'Pi', 
        url: 'https://pi.ai', 
        icon: 'ğŸ¥§', 
        color: '#8b5cf6',
        status: 'åœ¨çº¿',
        category: 'èŠå¤©AI'
      },
      { 
        id: 'character', 
        name: 'Character.AI', 
        url: 'https://character.ai', 
        icon: 'ğŸ‘¤', 
        color: '#ec4899',
        status: 'åœ¨çº¿',
        category: 'è§’è‰²AI'
      },
      { 
        id: 'midjourney', 
        name: 'Midjourney', 
        url: 'https://www.midjourney.com', 
        icon: 'ğŸ¨', 
        color: '#1d4ed8',
        status: 'åœ¨çº¿',
        category: 'å›¾åƒAI'
      },
      { 
        id: 'notion', 
        name: 'Notion AI', 
        url: 'https://www.notion.so', 
        icon: 'ğŸ“', 
        color: '#000000',
        status: 'åœ¨çº¿',
        category: 'å†™ä½œAI'
      },
      { 
        id: 'quillbot', 
        name: 'QuillBot', 
        url: 'https://quillbot.com', 
        icon: 'âœï¸', 
        color: '#7c3aed',
        status: 'åœ¨çº¿',
        category: 'å†™ä½œAI'
      },
      { 
        id: 'grammarly', 
        name: 'Grammarly', 
        url: 'https://www.grammarly.com', 
        icon: 'ğŸ“š', 
        color: '#10b981',
        status: 'åœ¨çº¿',
        category: 'å†™ä½œAI'
      }
    ];

    // åº”ç”¨çŠ¶æ€
    const state = {
      currentAI: 'DeepSeek',
      currentUrl: 'https://chat.deepseek.com',
      selectedAIs: new Set(['deepseek']),
      notes: [],
      chatHistory: [],
      tasks: [],
      queryCount: 0,
      sessionStartTime: new Date(),
      isSplitScreen: false,
      activeSection: 'ai-selector',
      aiFilter: '',
      customAIs: [],
      splitPanels: [], // å­˜å‚¨åˆ†å±é¢æ¿ä¿¡æ¯
      maxSplitPanels: 4 // æœ€å¤§åˆ†å±æ•°é‡
    };

    // åˆå§‹åŒ–åº”ç”¨
    function init() {
      setupEventListeners();
      setupResizeHandle();
      loadData();
      updateAiSelector();
      updateChatHistory();
      updateStats();
      updateTaskList();
      
      // é»˜è®¤å±•å¼€AIé€‰æ‹©å™¨
      toggleSection('ai-selector');
      
      // æ˜¾ç¤ºé€šçŸ¥
      setTimeout(() => {
        showNotification('AIåä½œç³»ç»Ÿå·²å°±ç»ªï¼é€‰æ‹©AIå¹¶å¼€å§‹æé—®ã€‚', 'success');
      }, 1000);
      
      // å¯åŠ¨ä¼šè¯æ—¶é—´è®¡æ—¶å™¨
      setInterval(updateStats, 60000);
    }

    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      // æŠ˜å é¢æ¿åˆ‡æ¢
      document.querySelectorAll('.section-header').forEach(header => {
        header.addEventListener('click', (e) => {
          const section = e.currentTarget.dataset.section;
          toggleSection(section);
        });
      });
      
      // AIæœç´¢
      document.getElementById('aiSearch').addEventListener('input', (e) => {
        state.aiFilter = e.target.value.toLowerCase();
        updateAiSelector();
      });
      
      // AIé€‰æ‹©
      document.addEventListener('click', (e) => {
        if (e.target.closest('.ai-option')) {
          const aiOption = e.target.closest('.ai-option');
          const aiId = aiOption.dataset.id;
          
          if (e.ctrlKey || e.metaKey) {
            // Ctrl+ç‚¹å‡»ï¼šå¤šé€‰
            toggleAiSelection(aiId);
          } else if (e.shiftKey) {
            // Shift+ç‚¹å‡»ï¼šèŒƒå›´é€‰æ‹©
            selectAiRange(aiId);
          } else {
            // æ™®é€šç‚¹å‡»ï¼šå•é€‰å¹¶æ‰“å¼€
            selectSingleAi(aiId);
            const ai = getAllAIs().find(a => a.id === aiId);
            if (ai) {
              openAiWebsite(ai.url, ai.name);
            }
          }
        }
      });
      
      // åŠŸèƒ½æŒ‰é’®
      document.querySelectorAll('.function-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const functionName = e.currentTarget.dataset.function;
          executeFunction(functionName);
        });
      });
      
      // æŒ‰é’®äº‹ä»¶
      document.getElementById('openSelectedAi').addEventListener('click', openSelectedAi);
      document.getElementById('multiOpenAi').addEventListener('click', openMultiAiModal);
      document.getElementById('addCustomAi').addEventListener('click', addCustomAi);
      document.getElementById('sendToAi').addEventListener('click', sendToAi);
      document.getElementById('saveQuestion').addEventListener('click', saveQuestion);
      document.getElementById('saveNote').addEventListener('click', saveNote);
      document.getElementById('clearNotes').addEventListener('click', clearNotes);
      document.getElementById('selectAllAi').addEventListener('click', selectAllAi);
      document.getElementById('deselectAllAi').addEventListener('click', deselectAllAi);
      document.getElementById('addSplitBtn').addEventListener('click', addSplitPanel);
      
      document.getElementById('questionPreset').addEventListener('change', (e) => {
        if (e.target.value) {
          document.getElementById('questionInput').value = e.target.value;
        }
      });
      
      // è¿”å›ä¸»é¡µ
      document.getElementById('returnMain').addEventListener('click', returnToMain);
      
      // æµè§ˆå™¨æ§åˆ¶
      document.getElementById('goBack').addEventListener('click', () => {
        try {
          if (state.isSplitScreen && state.splitPanels.length > 0) {
            const firstPanel = state.splitPanels[0];
            const frame = document.getElementById(`splitFrame${firstPanel.id}`);
            if (frame && frame.contentWindow) {
              frame.contentWindow.history.back();
            }
          } else {
            document.getElementById('aiFrame').contentWindow.history.back();
          }
        } catch (e) {
          showNotification('æ— æ³•åé€€ï¼ˆè·¨åŸŸé™åˆ¶ï¼‰', 'warning');
        }
      });
      
      document.getElementById('goForward').addEventListener('click', () => {
        try {
          if (state.isSplitScreen && state.splitPanels.length > 0) {
            const firstPanel = state.splitPanels[0];
            const frame = document.getElementById(`splitFrame${firstPanel.id}`);
            if (frame && frame.contentWindow) {
              frame.contentWindow.history.forward();
            }
          } else {
            document.getElementById('aiFrame').contentWindow.history.forward();
          }
        } catch (e) {
          showNotification('æ— æ³•å‰è¿›ï¼ˆè·¨åŸŸé™åˆ¶ï¼‰', 'warning');
        }
      });
      
      document.getElementById('refreshPage').addEventListener('click', () => {
        if (state.isSplitScreen) {
          state.splitPanels.forEach(panel => {
            const frame = document.getElementById(`splitFrame${panel.id}`);
            if (frame) {
              frame.src = frame.src;
            }
          });
        } else {
          const iframe = document.getElementById('aiFrame');
          iframe.src = iframe.src;
        }
        showLoading(true);
      });
      
      document.getElementById('goHome').addEventListener('click', () => {
        if (state.isSplitScreen) {
          openAiWebsite(state.currentUrl, state.currentAI);
        } else {
          openAiWebsite(state.currentUrl, state.currentAI);
        }
      });
      
      document.getElementById('toggleSplit').addEventListener('click', toggleSplitScreen);
      
      // URLè¾“å…¥æ¡†
      document.getElementById('urlInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          const url = e.target.value.trim();
          if (url) {
            openAiWebsite(url, 'è‡ªå®šä¹‰ç½‘ç«™');
          }
        }
      });
      
      // iframeåŠ è½½äº‹ä»¶
      document.getElementById('aiFrame').addEventListener('load', () => {
        showLoading(false);
      });
      
      // åˆ†å±iframeåŠ è½½äº‹ä»¶ä¼šåœ¨åˆ›å»ºæ—¶åŠ¨æ€æ·»åŠ 
      
      // æ¨¡æ€æ¡†äº‹ä»¶
      document.getElementById('closeModal').addEventListener('click', () => {
        document.getElementById('multiOpenModal').style.display = 'none';
      });
      
      document.getElementById('cancelMultiOpen').addEventListener('click', () => {
        document.getElementById('multiOpenModal').style.display = 'none';
      });
      
      document.getElementById('confirmMultiOpen').addEventListener('click', openSelectedAIs);
      
      // ä»£ç ç¼–è¾‘å™¨äº‹ä»¶
      document.querySelectorAll('.close-code-editor').forEach(btn => {
        btn.addEventListener('click', () => {
          document.getElementById('codeEditorModal').style.display = 'none';
        });
      });
      
      document.getElementById('runCode').addEventListener('click', runCode);
      document.getElementById('clearCode').addEventListener('click', () => {
        document.getElementById('codeEditor').value = '';
        document.getElementById('codeOutput').value = '';
      });
      
      // ä»»åŠ¡ç®¡ç†å™¨äº‹ä»¶
      document.querySelectorAll('.close-task-manager').forEach(btn => {
        btn.addEventListener('click', () => {
          document.getElementById('taskManagerModal').style.display = 'none';
        });
      });
      
      document.getElementById('addTask').addEventListener('click', addTask);
      document.getElementById('clearCompletedTasks').addEventListener('click', clearCompletedTasks);
      
      // é”®ç›˜å¿«æ·é”®
      document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + Enter å‘é€é—®é¢˜
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
          e.preventDefault();
          sendToAi();
        }
        
        // Ctrl/Cmd + N æ–°å»ºç¬”è®°
        if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
          e.preventDefault();
          document.getElementById('noteTitle').value = '';
          document.getElementById('noteContent').value = '';
        }
        
        // Ctrl/Cmd + S åˆ‡æ¢åˆ†å±
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
          e.preventDefault();
          toggleSplitScreen();
        }
        
        // Ctrl/Cmd + A å…¨é€‰AI
        if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
          if (state.activeSection === 'ai-selector') {
            e.preventDefault();
            selectAllAi();
          }
        }
        
        // Esc å…³é—­æ‰€æœ‰æ¨¡æ€æ¡†
        if (e.key === 'Escape') {
          document.getElementById('multiOpenModal').style.display = 'none';
          document.getElementById('codeEditorModal').style.display = 'none';
          document.getElementById('taskManagerModal').style.display = 'none';
        }

        // Shift + Esc è¿”å›ä¸»ç•Œé¢
        if (e.shiftKey && e.key === 'Escape') {
          e.preventDefault();
          returnToMain();
        }
      });
    }

    // è®¾ç½®å¯è°ƒèŠ‚åˆ†å‰²çº¿
    function setupResizeHandle() {
      const resizeHandle = document.getElementById('resizeHandle');
      const controlPanel = document.querySelector('.control-panel');
      if (!resizeHandle || !controlPanel) return;
      
      let isResizing = false;
      let startX = 0;
      let startWidth = 0;
      const minW = 320;
      const maxW = 800;
      
      function onPointerDown(clientX) {
        isResizing = true;
        startX = clientX;
        startWidth = controlPanel.offsetWidth;
        document.body.style.cursor = 'col-resize';
      }
      
      function onPointerMove(clientX) {
        if (!isResizing) return;
        const deltaX = clientX - startX;
        const newWidth = Math.max(minW, Math.min(maxW, startWidth + deltaX));
        controlPanel.style.width = `${newWidth}px`;
        controlPanel.style.minWidth = `${newWidth}px`;
      }
      
      function onPointerUp() {
        if (isResizing) {
          isResizing = false;
          document.body.style.cursor = '';
        }
      }

      // Mouse events
      resizeHandle.addEventListener('mousedown', (e) => {
        onPointerDown(e.clientX);
        e.preventDefault();
      });
      document.addEventListener('mousemove', (e) => onPointerMove(e.clientX));
      document.addEventListener('mouseup', onPointerUp);

      // Touch events
      resizeHandle.addEventListener('touchstart', (e) => {
        const t = e.touches[0];
        onPointerDown(t.clientX);
        e.preventDefault();
      }, { passive: false });
      document.addEventListener('touchmove', (e) => {
        const t = e.touches[0];
        onPointerMove(t.clientX);
      }, { passive: false });
      document.addEventListener('touchend', onPointerUp);

      // Prevent text selection during drag
      document.addEventListener('selectstart', (e) => {
        if (isResizing) e.preventDefault();
      });
    }

    // è·å–æ‰€æœ‰AIï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ï¼‰
    function getAllAIs() {
      return [...AI_WEBSITES, ...state.customAIs];
    }

    // åˆ‡æ¢é¢æ¿å±•å¼€/æŠ˜å 
    function toggleSection(sectionId) {
      const content = document.getElementById(`${sectionId}-content`);
      const toggle = document.querySelector(`[data-section="${sectionId}"] .section-toggle`);
      
      if (content.classList.contains('expanded')) {
        content.classList.remove('expanded');
        toggle.textContent = 'â–¼';
        state.activeSection = null;
      } else {
        // å…³é—­å…¶ä»–é¢æ¿
        document.querySelectorAll('.section-content').forEach(el => {
          el.classList.remove('expanded');
        });
        document.querySelectorAll('.section-toggle').forEach(el => {
          el.textContent = 'â–¼';
        });
        
        // æ‰“å¼€å½“å‰é¢æ¿
        content.classList.add('expanded');
        toggle.textContent = 'â–²';
        state.activeSection = sectionId;
      }
    }

    // æ›´æ–°AIé€‰æ‹©å™¨
    function updateAiSelector() {
      const aiSelectorGrid = document.getElementById('aiSelectorGrid');
      const allAIs = getAllAIs();
      
      // è¿‡æ»¤AI
      let filteredAIs = allAIs;
      if (state.aiFilter) {
        filteredAIs = allAIs.filter(ai => 
          ai.name.toLowerCase().includes(state.aiFilter) || 
          ai.category.toLowerCase().includes(state.aiFilter)
        );
      }
      
      // æŒ‰ç±»åˆ«åˆ†ç»„
      const groupedAIs = {};
      filteredAIs.forEach(ai => {
        if (!groupedAIs[ai.category]) {
          groupedAIs[ai.category] = [];
        }
        groupedAIs[ai.category].push(ai);
      });
      
      let html = '';
      
      // éå†æ¯ä¸ªç±»åˆ«
      for (const category in groupedAIs) {
        html += `<div style="grid-column: 1 / -1; font-size: 12px; color: var(--muted); margin: 10px 0 5px 0;">${category}</div>`;
        
        groupedAIs[category].forEach(ai => {
          const isSelected = state.selectedAIs.has(ai.id);
          html += `
            <div class="ai-option ${isSelected ? 'selected' : ''}" data-id="${ai.id}" title="${ai.name} - ${ai.url}">
              <div class="ai-icon" style="background: ${ai.color}20; color: ${ai.color}">${ai.icon}</div>
              <div class="ai-name">${ai.name}</div>
              <div class="ai-status">${ai.status}</div>
            </div>
          `;
        });
      }
      
      aiSelectorGrid.innerHTML = html;
      document.getElementById('aiCount').textContent = allAIs.length;
      document.getElementById('selectedCount').textContent = state.selectedAIs.size;
    }

    // åˆ‡æ¢AIé€‰æ‹©çŠ¶æ€
    function toggleAiSelection(aiId) {
      if (state.selectedAIs.has(aiId)) {
        state.selectedAIs.delete(aiId);
      } else {
        state.selectedAIs.add(aiId);
      }
      
      updateAiSelector();
    }

    // é€‰æ‹©å•ä¸ªAI
    function selectSingleAi(aiId) {
      state.selectedAIs.clear();
      state.selectedAIs.add(aiId);
      updateAiSelector();
    }

    // é€‰æ‹©AIèŒƒå›´ï¼ˆShift+ç‚¹å‡»ï¼‰
    function selectAiRange(aiId) {
      const allAIs = getAllAIs();
      const aiIndex = allAIs.findIndex(ai => ai.id === aiId);
      const selectedAIs = Array.from(state.selectedAIs);
      
      if (selectedAIs.length === 0) {
        state.selectedAIs.add(aiId);
      } else {
        const lastSelectedId = selectedAIs[selectedAIs.length - 1];
        const lastSelectedIndex = allAIs.findIndex(ai => ai.id === lastSelectedId);
        
        const start = Math.min(aiIndex, lastSelectedIndex);
        const end = Math.max(aiIndex, lastSelectedIndex);
        
        for (let i = start; i <= end; i++) {
          state.selectedAIs.add(allAIs[i].id);
        }
      }
      
      updateAiSelector();
    }

    // å…¨é€‰AI
    function selectAllAi() {
      const allAIs = getAllAIs();
      allAIs.forEach(ai => {
        state.selectedAIs.add(ai.id);
      });
      updateAiSelector();
      showNotification(`å·²é€‰æ‹©æ‰€æœ‰ ${allAIs.length} ä¸ªAI`, 'success');
    }

    // å…¨ä¸é€‰AI
    function deselectAllAi() {
      state.selectedAIs.clear();
      updateAiSelector();
      showNotification('å·²å–æ¶ˆé€‰æ‹©æ‰€æœ‰AI', 'info');
    }

    // æ‰“å¼€AIç½‘ç«™
    function openAiWebsite(url, name, panelId = null) {
      // ç¡®ä¿URLæ ¼å¼æ­£ç¡®
      let fullUrl = url;
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        fullUrl = 'https://' + url;
      }
      
      // æ›´æ–°çŠ¶æ€
      state.currentUrl = fullUrl;
      state.currentAI = name;
      document.getElementById('urlInput').value = fullUrl;
      
      // æ˜¾ç¤ºåŠ è½½ä¸­
      showLoading(true);
      
      if (state.isSplitScreen && panelId) {
        // åœ¨æŒ‡å®šåˆ†å±é¢æ¿ä¸­æ‰“å¼€
        const frame = document.getElementById(`splitFrame${panelId}`);
        if (frame) {
          frame.src = fullUrl;
        }
      } else if (state.isSplitScreen && state.splitPanels.length > 0) {
        // åœ¨ç¬¬ä¸€ä¸ªåˆ†å±é¢æ¿ä¸­æ‰“å¼€
        const firstPanel = state.splitPanels[0];
        const frame = document.getElementById(`splitFrame${firstPanel.id}`);
        if (frame) {
          frame.src = fullUrl;
        }
      } else {
        // åœ¨å•å±æ¨¡å¼ä¸­æ‰“å¼€
        const iframe = document.getElementById('aiFrame');
        iframe.src = fullUrl;
      }
      
      showNotification(`æ­£åœ¨æ‰“å¼€${name}...`, 'info');
    }

    // æ‰“å¼€é€‰ä¸­çš„AI
    function openSelectedAi() {
      if (state.selectedAIs.size === 0) {
        showNotification('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªAI', 'warning');
        return;
      }
      
      const selectedAiId = Array.from(state.selectedAIs)[0];
      const allAIs = getAllAIs();
      const ai = allAIs.find(a => a.id === selectedAiId);
      
      if (ai) {
        openAiWebsite(ai.url, ai.name);
      }
    }

    // æ‰“å¼€å¤šå¼€æ¨¡æ€æ¡†
    function openMultiAiModal() {
      if (state.selectedAIs.size === 0) {
        showNotification('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªAI', 'warning');
        return;
      }
      
      const modalAiList = document.getElementById('modalAiList');
      const allAIs = getAllAIs();
      
      let html = '';
      
      allAIs.forEach(ai => {
        const isSelected = state.selectedAIs.has(ai.id);
        html += `
          <div class="ai-option ${isSelected ? 'selected' : ''}" style="margin-bottom: 10px;">
            <input type="checkbox" id="modal-ai-${ai.id}" ${isSelected ? 'checked' : ''}>
            <label for="modal-ai-${ai.id}" style="flex:1; cursor:pointer;">
              <div style="display:flex; align-items:center; gap:10px;">
                <div style="width:24px; height:24px; border-radius:6px; background:${ai.color}20; color:${ai.color}; display:flex; align-items:center; justify-content:center;">${ai.icon}</div>
                <div>
                  <strong>${ai.name}</strong><br>
                  <small style="color: var(--muted);">${ai.category} Â· ${ai.url.replace('https://', '').replace('http://', '')}</small>
                </div>
              </div>
            </label>
          </div>
        `;
      });
      
      modalAiList.innerHTML = html;
      
      // æ·»åŠ å¤é€‰æ¡†äº‹ä»¶
      modalAiList.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
          const aiId = e.target.id.replace('modal-ai-', '');
          const aiOption = e.target.closest('.ai-option');
          
          if (e.target.checked) {
            state.selectedAIs.add(aiId);
            aiOption.classList.add('selected');
          } else {
            state.selectedAIs.delete(aiId);
            aiOption.classList.remove('selected');
          }
          
          updateAiSelector();
        });
      });
      
      document.getElementById('multiOpenModal').style.display = 'flex';
    }

    // æ‰“å¼€é€‰ä¸­çš„å¤šä¸ªAI
    function openSelectedAIs() {
      if (state.selectedAIs.size === 0) {
        showNotification('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªAI', 'warning');
        return;
      }
      
      // å…³é—­æ¨¡æ€æ¡†
      document.getElementById('multiOpenModal').style.display = 'none';
      
      // æ‰“å¼€æ¯ä¸ªé€‰ä¸­çš„AIç½‘ç«™
      const allAIs = getAllAIs();
      const selectedAIs = allAIs.filter(ai => state.selectedAIs.has(ai.id));
      
      // å¦‚æœåˆ†å±æ¨¡å¼å¼€å¯ï¼Œåˆ†é…åˆ°åˆ†å±ä¸­
      if (state.isSplitScreen && state.splitPanels.length > 0) {
        selectedAIs.forEach((ai, index) => {
          if (index < state.splitPanels.length) {
            const panel = state.splitPanels[index];
            openAiWebsite(ai.url, ai.name, panel.id);
          } else {
            // å¦‚æœåˆ†å±ä¸å¤Ÿï¼Œåœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
            setTimeout(() => {
              window.open(ai.url, `ai_${ai.id}`);
            }, index * 300);
          }
        });
      } else {
        // åœ¨ä¸»çª—å£ä¸­æ‰“å¼€ç¬¬ä¸€ä¸ªç½‘ç«™
        const firstAi = selectedAIs[0];
        openAiWebsite(firstAi.url, firstAi.name);
        
        // åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€å…¶ä»–ç½‘ç«™
        for (let i = 1; i < selectedAIs.length; i++) {
          setTimeout(() => {
            window.open(selectedAIs[i].url, `ai_${selectedAIs[i].id}`);
          }, i * 300);
        }
      }
      
      showNotification(`å·²æ‰“å¼€ ${selectedAIs.length} ä¸ªAIç½‘ç«™`, 'success');
    }

    // æ·»åŠ è‡ªå®šä¹‰AI
    function addCustomAi() {
      const urlInput = document.getElementById('customAiUrl');
      const url = urlInput.value.trim();
      
      if (!url) {
        showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„URL', 'warning');
        return;
      }
      
      // ç®€å•çš„URLéªŒè¯
      let fullUrl = url;
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        fullUrl = 'https://' + url;
      }
      
      // åˆ›å»ºè‡ªå®šä¹‰AI
      const customAi = {
        id: 'custom-' + Date.now(),
        name: `è‡ªå®šä¹‰AI-${state.customAIs.length + 1}`,
        url: fullUrl,
        icon: 'ğŸ”—',
        color: '#9fb0c8',
        status: 'è‡ªå®šä¹‰',
        category: 'è‡ªå®šä¹‰AI'
      };
      
      // æ·»åŠ åˆ°è‡ªå®šä¹‰AIåˆ—è¡¨
      state.customAIs.push(customAi);
      updateAiSelector();
      
      // é€‰ä¸­è¿™ä¸ªAI
      selectSingleAi(customAi.id);
      
      urlInput.value = '';
      saveData(); // ä¿å­˜è‡ªå®šä¹‰AIåˆ°æœ¬åœ°å­˜å‚¨
      showNotification('è‡ªå®šä¹‰AIå·²æ·»åŠ ', 'success');
    }

    // å‘é€é—®é¢˜åˆ°AI
    function sendToAi() {
      const question = document.getElementById('questionInput').value.trim();
      
      if (!question) {
        showNotification('è¯·è¾“å…¥é—®é¢˜å†…å®¹', 'warning');
        return;
      }
      
      // æ›´æ–°ç»Ÿè®¡
      state.queryCount++;
      updateStats();
      
      // æ·»åŠ åˆ°èŠå¤©å†å²
      const chatItem = {
        id: Date.now(),
        type: 'question',
        content: question,
        ai: state.currentAI,
        timestamp: new Date().toLocaleTimeString()
      };
      
      state.chatHistory.unshift(chatItem);
      updateChatHistory();
      saveData();
      
      // å°è¯•è‡ªåŠ¨å¡«å†™é—®é¢˜åˆ°AIç½‘ç«™
      tryAutoFillQuestion(question);
      
      showNotification(`é—®é¢˜å·²å‘é€åˆ°${state.currentAI}`, 'success');
    }

    // å°è¯•è‡ªåŠ¨å¡«å†™é—®é¢˜
    function tryAutoFillQuestion(question) {
      // ç”±äºè·¨åŸŸé™åˆ¶ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥æ§åˆ¶iframeä¸­çš„å†…å®¹
      // è¿™é‡Œæˆ‘ä»¬æä¾›å‡ ç§å¯èƒ½çš„è‡ªåŠ¨å¡«å†™æ–¹æ³•
      
      // æ–¹æ³•1: å°è¯•é€šè¿‡postMessageå‘é€ï¼ˆéœ€è¦ç›®æ ‡ç½‘ç«™æ”¯æŒï¼‰
      try {
        if (state.isSplitScreen && state.splitPanels.length > 0) {
          state.splitPanels.forEach(panel => {
            const frame = document.getElementById(`splitFrame${panel.id}`);
            if (frame && frame.contentWindow) {
              frame.contentWindow.postMessage({
                type: 'AI_QUESTION',
                question: question
              }, '*');
            }
          });
        } else {
          document.getElementById('aiFrame').contentWindow.postMessage({
            type: 'AI_QUESTION',
            question: question
          }, '*');
        }
      } catch (e) {
        // å¿½ç•¥é”™è¯¯
      }
      
      // æ–¹æ³•2: æ˜¾ç¤ºæç¤ºè®©ç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶
      showNotification(`é—®é¢˜å·²å‡†å¤‡ï¼Œè¯·åœ¨AIç½‘ç«™ä¸­ç²˜è´´é—®é¢˜`, 'info');
      
      // å°†é—®é¢˜å¤åˆ¶åˆ°å‰ªè´´æ¿
      copyToClipboard(question);
    }

    // ä¿å­˜é—®é¢˜
    function saveQuestion() {
      const question = document.getElementById('questionInput').value.trim();
      
      if (!question) {
        showNotification('é—®é¢˜å†…å®¹ä¸ºç©º', 'warning');
        return;
      }
      
      // æ·»åŠ åˆ°ç¬”è®°
      const note = {
        id: Date.now(),
        title: `é—®é¢˜: ${question.substring(0, 30)}${question.length > 30 ? '...' : ''}`,
        content: question,
        type: 'question',
        timestamp: new Date().toLocaleString(),
        linkedAi: state.currentAI
      };
      
      state.notes.unshift(note);
      saveData();
      updateStats();
      
      showNotification('é—®é¢˜å·²ä¿å­˜åˆ°ç¬”è®°', 'success');
    }

    // ä¿å­˜ç¬”è®°
    function saveNote() {
      const title = document.getElementById('noteTitle').value.trim();
      const content = document.getElementById('noteContent').value.trim();
      
      if (!title && !content) {
        showNotification('ç¬”è®°æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½éƒ½ä¸ºç©º', 'warning');
        return;
      }
      
      const note = {
        id: Date.now(),
        title: title || 'æœªå‘½åç¬”è®°',
        content: content,
        type: 'note',
        timestamp: new Date().toLocaleString(),
        linkedAi: state.currentAI
      };
      
      state.notes.unshift(note);
      saveData();
      updateStats();
      
      // æ¸…ç©ºç¼–è¾‘å™¨
      document.getElementById('noteTitle').value = '';
      document.getElementById('noteContent').value = '';
      
      showNotification('ç¬”è®°å·²ä¿å­˜', 'success');
    }

    // æ¸…ç©ºç¬”è®°
    function clearNotes() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç¬”è®°å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
        state.notes = [];
        saveData();
        updateStats();
        showNotification('å·²æ¸…ç©ºæ‰€æœ‰ç¬”è®°', 'info');
      }
    }

    // æ›´æ–°èŠå¤©å†å²
    function updateChatHistory() {
      const chatHistory = document.getElementById('chatHistory');
      
      if (state.chatHistory.length === 0) {
        chatHistory.innerHTML = `
          <div style="text-align:center; padding:20px; color:var(--muted);">
            <div style="font-size:36px; margin-bottom:8px;">ğŸ’¬</div>
            <div>æš‚æ— èŠå¤©è®°å½•</div>
          </div>
        `;
        return;
      }
      
      let html = '';
      
      state.chatHistory.slice(0, 5).forEach(item => {
        const isQuestion = item.type === 'question';
        const shortContent = item.content.length > 80 ? 
          item.content.substring(0, 80) + '...' : item.content;
        
        html += `
          <div class="chat-item">
            <div class="chat-ai">
              ${isQuestion ? 'â“' : 'ğŸ’¬'} ${item.ai}
              <span class="chat-time">${item.timestamp}</span>
            </div>
            <div class="chat-text">${escapeHtml(shortContent)}</div>
          </div>
        `;
      });
      
      chatHistory.innerHTML = html;
    }

    // æ‰§è¡ŒåŠŸèƒ½
    function executeFunction(functionName) {
      switch(functionName) {
        case 'split-screen':
          toggleSplitScreen();
          break;
        case 'auto-query':
          autoQueryAllAis();
          break;
        case 'answer-compare':
          compareAiAnswers();
          break;
        case 'ai-chat':
          simulateAiChat();
          break;
        case 'code-editor':
          document.getElementById('codeEditorModal').style.display = 'flex';
          break;
        case 'task-manager':
          document.getElementById('taskManagerModal').style.display = 'flex';
          break;
        case 'text-tools':
          showTextTools();
          break;
        case 'quick-calc':
          showQuickCalculator();
          break;
        default:
          showNotification(`åŠŸèƒ½ ${functionName} å¼€å‘ä¸­`, 'info');
      }
    }

    // åˆ›å»ºåˆ†å±é¢æ¿
    function createSplitPanel(panelId, ai = null, width = null) {
      const splitScreen = document.getElementById('splitScreen');
      
      // åˆ›å»ºåˆ†å±é¢æ¿
      const panel = document.createElement('div');
      panel.className = 'split-panel';
      panel.id = `splitPanel${panelId}`;
      if (width) {
        panel.style.width = width;
      }
      
      // åˆ›å»ºé¢æ¿å¤´éƒ¨
      const header = document.createElement('div');
      header.className = 'split-header';
      
      // åˆ›å»ºæ ‡é¢˜åŒºåŸŸ
      const title = document.createElement('div');
      title.className = 'split-title';
      title.innerHTML = `
        <span>${ai ? ai.icon : 'ğŸ¤–'}</span>
        <span>${ai ? ai.name : `AI ${panelId}`}</span>
      `;
      
      // åˆ›å»ºAIé€‰æ‹©å™¨
      const aiSelector = document.createElement('div');
      aiSelector.className = 'split-ai-selector';
      const select = document.createElement('select');
      select.className = 'split-ai-select';
      select.id = `splitAiSelect${panelId}`;
      select.dataset.panelId = panelId;
      
      // æ·»åŠ AIé€‰é¡¹
      const allAIs = getAllAIs();
      allAIs.forEach(aiOption => {
        const option = document.createElement('option');
        option.value = aiOption.id;
        option.textContent = `${aiOption.icon} ${aiOption.name}`;
        if (ai && ai.id === aiOption.id) {
          option.selected = true;
        }
        select.appendChild(option);
      });
      
      // æ·»åŠ è‡ªå®šä¹‰URLé€‰é¡¹
      const customOption = document.createElement('option');
      customOption.value = 'custom';
      customOption.textContent = 'ğŸ”— è‡ªå®šä¹‰URL';
      select.appendChild(customOption);
      
      aiSelector.appendChild(select);
      
      // åˆ›å»ºæ§åˆ¶æŒ‰é’®
      const controls = document.createElement('div');
      controls.className = 'split-controls';
      controls.innerHTML = `
        <button class="split-control-btn" data-panel="${panelId}" data-action="swap" title="äº¤æ¢ä½ç½®">â†”ï¸</button>
        <button class="split-control-btn" data-panel="${panelId}" data-action="close" title="å…³é—­é¢æ¿">âœ•</button>
      `;
      
      // ç»„è£…å¤´éƒ¨
      header.appendChild(title);
      header.appendChild(aiSelector);
      header.appendChild(controls);
      
      // åˆ›å»ºiframeå®¹å™¨
      const iframeContainer = document.createElement('div');
      iframeContainer.className = 'iframe-container';
      const iframe = document.createElement('iframe');
      iframe.id = `splitFrame${panelId}`;
      iframe.src = ai ? ai.url : 'https://chat.deepseek.com';
      iframeContainer.appendChild(iframe);
      
      // ç»„è£…é¢æ¿
      panel.appendChild(header);
      panel.appendChild(iframeContainer);
      
      // æ·»åŠ é¢æ¿åˆ°åˆ†å±å®¹å™¨
      splitScreen.appendChild(panel);
      
      // æ·»åŠ iframeåŠ è½½äº‹ä»¶
      iframe.addEventListener('load', () => {
        showLoading(false);
      });
      
      // æ·»åŠ AIé€‰æ‹©å™¨äº‹ä»¶
      select.addEventListener('change', (e) => {
        const selectedAiId = e.target.value;
        if (selectedAiId === 'custom') {
          // è‡ªå®šä¹‰URL
          const customUrl = prompt('è¯·è¾“å…¥è‡ªå®šä¹‰AI URL:', 'https://chat.deepseek.com');
          if (customUrl) {
            openAiWebsite(customUrl, 'è‡ªå®šä¹‰AI', panelId);
          }
        } else {
          const selectedAi = allAIs.find(ai => ai.id === selectedAiId);
          if (selectedAi) {
            openAiWebsite(selectedAi.url, selectedAi.name, panelId);
          }
        }
      });
      
      // æ·»åŠ æ§åˆ¶æŒ‰é’®äº‹ä»¶
      controls.querySelectorAll('.split-control-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const action = e.currentTarget.dataset.action;
          if (action === 'swap') {
            swapSplitPanel(panelId);
          } else if (action === 'close') {
            removeSplitPanel(panelId);
          }
        });
      });
      
      // è¿”å›é¢æ¿ä¿¡æ¯
      return {
        id: panelId,
        ai: ai,
        element: panel,
        iframe: iframe
      };
    }

    // åˆ›å»ºåˆ†å±è°ƒæ•´å™¨
    function createSplitResizer(resizerId) {
      const resizer = document.createElement('div');
      resizer.className = 'split-resizer';
      resizer.id = `splitResizer${resizerId}`;
      resizer.dataset.resizerId = resizerId;
      
      return resizer;
    }

    // åˆå§‹åŒ–åˆ†å±æ¨¡å¼
    function initSplitScreen() {
      const splitScreen = document.getElementById('splitScreen');
      splitScreen.innerHTML = '';
      state.splitPanels = [];
      
      // è·å–é€‰ä¸­çš„AI
      const allAIs = getAllAIs();
      const selectedAIs = Array.from(state.selectedAIs);
      
      // åˆ›å»ºåˆå§‹åˆ†å±ï¼ˆæœ€å¤š2ä¸ªï¼‰
      const initialPanelCount = Math.min(2, Math.max(1, selectedAIs.length));
      
      for (let i = 1; i <= initialPanelCount; i++) {
        let ai = null;
        if (i <= selectedAIs.length) {
          ai = allAIs.find(a => a.id === selectedAIs[i-1]);
        } else if (i === 1) {
          // é»˜è®¤ä½¿ç”¨DeepSeek
          ai = allAIs.find(a => a.id === 'deepseek');
        }
        
        const panel = createSplitPanel(i, ai, i === 1 ? '50%' : null);
        state.splitPanels.push(panel);
        
        // åœ¨é¢æ¿ä¹‹é—´æ·»åŠ è°ƒæ•´å™¨ï¼ˆé™¤äº†æœ€åä¸€ä¸ªï¼‰
        if (i < initialPanelCount) {
          const resizer = createSplitResizer(i);
          splitScreen.appendChild(resizer);
          setupSplitResizer(resizer, i, i+1);
        }
      }
      
      // æ˜¾ç¤ºæ·»åŠ åˆ†å±æŒ‰é’®
      document.getElementById('addSplitContainer').style.display = 'flex';
      updateAddSplitButton();
      
      // è®¾ç½®åˆ†å±æ‹–æ‹½è°ƒæ•´
      setupSplitResizers();
    }

    // è®¾ç½®åˆ†å±è°ƒæ•´å™¨
    function setupSplitResizer(resizer, leftPanelId, rightPanelId) {
      const leftPanel = document.getElementById(`splitPanel${leftPanelId}`);
      const rightPanel = document.getElementById(`splitPanel${rightPanelId}`);
      
      if (!leftPanel || !rightPanel) return;
      
      let isResizing = false;
      let startX = 0;
      let startLeftWidth = 0;
      let startRightWidth = 0;
      const minWidth = 200; // æœ€å°å®½åº¦
      
      resizer.addEventListener('mousedown', (e) => {
        isResizing = true;
        startX = e.clientX;
        startLeftWidth = leftPanel.offsetWidth;
        startRightWidth = rightPanel.offsetWidth;
        document.body.style.cursor = 'col-resize';
        resizer.classList.add('resizing');
        e.preventDefault();
      });
      
      document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;
        
        const deltaX = e.clientX - startX;
        const newLeftWidth = startLeftWidth + deltaX;
        const newRightWidth = startRightWidth - deltaX;
        
        // æ£€æŸ¥æœ€å°å®½åº¦
        if (newLeftWidth >= minWidth && newRightWidth >= minWidth) {
          leftPanel.style.width = `${newLeftWidth}px`;
          rightPanel.style.flex = 'none';
          rightPanel.style.width = `${newRightWidth}px`;
        }
      });
      
      document.addEventListener('mouseup', () => {
        if (isResizing) {
          isResizing = false;
          document.body.style.cursor = '';
          resizer.classList.remove('resizing');
        }
      });
      
      // è§¦æ‘¸å±æ”¯æŒ
      resizer.addEventListener('touchstart', (e) => {
        const touch = e.touches[0];
        isResizing = true;
        startX = touch.clientX;
        startLeftWidth = leftPanel.offsetWidth;
        startRightWidth = rightPanel.offsetWidth;
        resizer.classList.add('resizing');
        e.preventDefault();
      }, { passive: false });
      
      document.addEventListener('touchmove', (e) => {
        if (!isResizing) return;
        const touch = e.touches[0];
        const deltaX = touch.clientX - startX;
        const newLeftWidth = startLeftWidth + deltaX;
        const newRightWidth = startRightWidth - deltaX;
        
        if (newLeftWidth >= minWidth && newRightWidth >= minWidth) {
          leftPanel.style.width = `${newLeftWidth}px`;
          rightPanel.style.flex = 'none';
          rightPanel.style.width = `${newRightWidth}px`;
        }
      }, { passive: false });
      
      document.addEventListener('touchend', () => {
        if (isResizing) {
          isResizing = false;
          resizer.classList.remove('resizing');
        }
      });
    }

    // è®¾ç½®æ‰€æœ‰åˆ†å±è°ƒæ•´å™¨
    function setupSplitResizers() {
      // ä¸ºæ¯ä¸ªè°ƒæ•´å™¨è®¾ç½®äº‹ä»¶
      document.querySelectorAll('.split-resizer').forEach(resizer => {
        const resizerId = parseInt(resizer.dataset.resizerId);
        setupSplitResizer(resizer, resizerId, resizerId + 1);
      });
    }

    // æ·»åŠ åˆ†å±é¢æ¿
    function addSplitPanel() {
      if (state.splitPanels.length >= state.maxSplitPanels) {
        showNotification(`æœ€å¤šåªèƒ½æ·»åŠ  ${state.maxSplitPanels} ä¸ªåˆ†å±`, 'warning');
        return;
      }
      
      const splitScreen = document.getElementById('splitScreen');
      const newPanelId = state.splitPanels.length + 1;
      
      // åœ¨æœ€åä¸€ä¸ªé¢æ¿å‰æ·»åŠ è°ƒæ•´å™¨
      if (state.splitPanels.length > 0) {
        const lastPanelId = state.splitPanels[state.splitPanels.length - 1].id;
        const resizer = createSplitResizer(lastPanelId);
        splitScreen.appendChild(resizer);
        setupSplitResizer(resizer, lastPanelId, newPanelId);
      }
      
      // åˆ›å»ºæ–°é¢æ¿
      const allAIs = getAllAIs();
      const selectedAIs = Array.from(state.selectedAIs);
      let ai = null;
      
      if (newPanelId <= selectedAIs.length) {
        ai = allAIs.find(a => a.id === selectedAIs[newPanelId-1]);
      } else {
        // é»˜è®¤ä½¿ç”¨DeepSeek
        ai = allAIs.find(a => a.id === 'deepseek');
      }
      
      const panel = createSplitPanel(newPanelId, ai);
      state.splitPanels.push(panel);
      
      // æ›´æ–°æ·»åŠ æŒ‰é’®çŠ¶æ€
      updateAddSplitButton();
      
      // é‡æ–°è®¾ç½®è°ƒæ•´å™¨äº‹ä»¶
      setupSplitResizers();
      
      showNotification(`å·²æ·»åŠ ç¬¬ ${newPanelId} ä¸ªåˆ†å±é¢æ¿`, 'success');
    }

    // ç§»é™¤åˆ†å±é¢æ¿
    function removeSplitPanel(panelId) {
      if (state.splitPanels.length <= 1) {
        showNotification('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªåˆ†å±é¢æ¿', 'warning');
        return;
      }
      
      // æ‰¾åˆ°é¢æ¿ç´¢å¼•
      const panelIndex = state.splitPanels.findIndex(p => p.id === panelId);
      if (panelIndex === -1) return;
      
      // ç§»é™¤é¢æ¿
      const panel = document.getElementById(`splitPanel${panelId}`);
      if (panel) panel.remove();
      
      // ç§»é™¤ç›¸å…³çš„è°ƒæ•´å™¨
      const resizerBefore = document.getElementById(`splitResizer${panelId-1}`);
      const resizerAfter = document.getElementById(`splitResizer${panelId}`);
      
      if (resizerBefore) resizerBefore.remove();
      if (resizerAfter) resizerAfter.remove();
      
      // ä»çŠ¶æ€ä¸­ç§»é™¤
      state.splitPanels.splice(panelIndex, 1);
      
      // é‡æ–°ç¼–å·å‰©ä½™çš„é¢æ¿
      renumberSplitPanels();
      
      // æ›´æ–°æ·»åŠ æŒ‰é’®çŠ¶æ€
      updateAddSplitButton();
      
      showNotification(`å·²ç§»é™¤åˆ†å±é¢æ¿ ${panelId}`, 'info');
    }

    // é‡æ–°ç¼–å·åˆ†å±é¢æ¿
    function renumberSplitPanels() {
      const splitScreen = document.getElementById('splitScreen');
      splitScreen.innerHTML = '';
      
      // é‡æ–°åˆ›å»ºæ‰€æœ‰é¢æ¿å’Œè°ƒæ•´å™¨
      state.splitPanels.forEach((panel, index) => {
        const newPanelId = index + 1;
        panel.id = newPanelId;
        
        // æ›´æ–°é¢æ¿DOM
        const panelElement = document.getElementById(`splitPanel${panel.id}`);
        if (panelElement) {
          panelElement.id = `splitPanel${newPanelId}`;
          panelElement.querySelector('.split-ai-select').id = `splitAiSelect${newPanelId}`;
          panelElement.querySelector('.split-ai-select').dataset.panelId = newPanelId;
          panelElement.querySelectorAll('.split-control-btn').forEach(btn => {
            btn.dataset.panel = newPanelId;
          });
          
          const iframe = panelElement.querySelector('iframe');
          if (iframe) {
            iframe.id = `splitFrame${newPanelId}`;
          }
        }
        
        // æ›´æ–°çŠ¶æ€ä¸­çš„é¢æ¿ID
        panel.id = newPanelId;
      });
      
      // é‡æ–°æ„å»ºåˆ†å±å¸ƒå±€
      state.splitPanels.forEach((panel, index) => {
        const newPanelId = index + 1;
        const panelElement = document.getElementById(`splitPanel${newPanelId}`);
        if (panelElement) {
          splitScreen.appendChild(panelElement);
          
          // åœ¨é¢æ¿ä¹‹é—´æ·»åŠ è°ƒæ•´å™¨ï¼ˆé™¤äº†æœ€åä¸€ä¸ªï¼‰
          if (index < state.splitPanels.length - 1) {
            const resizer = createSplitResizer(newPanelId);
            splitScreen.appendChild(resizer);
            setupSplitResizer(resizer, newPanelId, newPanelId + 1);
          }
        }
      });
      
      // é‡æ–°è®¾ç½®è°ƒæ•´å™¨äº‹ä»¶
      setupSplitResizers();
    }

    // äº¤æ¢åˆ†å±é¢æ¿ä½ç½®
    function swapSplitPanel(panelId) {
      const panelIndex = state.splitPanels.findIndex(p => p.id === panelId);
      if (panelIndex === -1 || state.splitPanels.length <= 1) return;
      
      // æ‰¾åˆ°è¦äº¤æ¢çš„é¢æ¿ï¼ˆä¸ä¸‹ä¸€ä¸ªé¢æ¿äº¤æ¢ï¼‰
      const swapIndex = (panelIndex + 1) % state.splitPanels.length;
      
      // äº¤æ¢çŠ¶æ€
      [state.splitPanels[panelIndex], state.splitPanels[swapIndex]] = 
      [state.splitPanels[swapIndex], state.splitPanels[panelIndex]];
      
      // é‡æ–°ç¼–å·å¹¶é‡å»ºå¸ƒå±€
      renumberSplitPanels();
      
      showNotification(`å·²äº¤æ¢åˆ†å±é¢æ¿ä½ç½®`, 'info');
    }

    // æ›´æ–°æ·»åŠ åˆ†å±æŒ‰é’®çŠ¶æ€
    function updateAddSplitButton() {
      const addSplitBtn = document.getElementById('addSplitBtn');
      if (state.splitPanels.length >= state.maxSplitPanels) {
        addSplitBtn.disabled = true;
        addSplitBtn.textContent = `å·²è¾¾åˆ°æœ€å¤§åˆ†å±æ•° (${state.maxSplitPanels})`;
      } else {
        addSplitBtn.disabled = false;
        addSplitBtn.innerHTML = '<span>+</span> æ·»åŠ åˆ†å±é¢æ¿';
      }
    }

    // åˆ‡æ¢åˆ†å±æ¨¡å¼
    function toggleSplitScreen() {
      state.isSplitScreen = !state.isSplitScreen;
      
      if (state.isSplitScreen) {
        // åˆ‡æ¢åˆ°åˆ†å±æ¨¡å¼
        document.getElementById('singleScreen').style.display = 'none';
        document.getElementById('splitScreen').style.display = 'flex';
        document.getElementById('addSplitContainer').style.display = 'flex';
        
        // åˆå§‹åŒ–åˆ†å±
        initSplitScreen();
        
        // è°ƒæ•´å¸ƒå±€
        adjustSplitLayout();
        
        showNotification('åˆ†å±æ¨¡å¼å·²å¼€å¯ï¼Œå¯æ‹–æ‹½è°ƒæ•´é¢æ¿å¤§å°', 'success');
      } else {
        // åˆ‡æ¢å›å•å±æ¨¡å¼
        document.getElementById('singleScreen').style.display = 'block';
        document.getElementById('splitScreen').style.display = 'none';
        document.getElementById('addSplitContainer').style.display = 'none';
        
        // æ¸…é™¤åˆ†å±çŠ¶æ€
        state.splitPanels = [];
        
        showNotification('åˆ†å±æ¨¡å¼å·²å…³é—­', 'info');
      }
    }

    // è°ƒæ•´åˆ†å±å¸ƒå±€ä»¥é€‚åº”å±å¹•å¤§å°
    function adjustSplitLayout() {
      const splitScreen = document.getElementById('splitScreen');
      if (!splitScreen || !state.isSplitScreen) return;
      
      const panels = Array.from(splitScreen.querySelectorAll('.split-panel'));
      const resizers = Array.from(splitScreen.querySelectorAll('.split-resizer'));
      
      if (window.innerWidth <= 900) {
        // å°å±å¹•ï¼šå‚ç›´å¸ƒå±€
        splitScreen.style.flexDirection = 'column';
        panels.forEach(p => {
          p.style.width = '100% !important';
          p.style.height = `${100 / panels.length}%`;
          p.style.minWidth = '100%';
        });
        resizers.forEach(r => {
          r.style.width = '100%';
          r.style.height = '8px';
          r.style.cursor = 'row-resize';
        });
      } else {
        // å¤§å±å¹•ï¼šæ°´å¹³å¸ƒå±€
        splitScreen.style.flexDirection = 'row';
        panels.forEach(p => {
          p.style.width = `${100 / panels.length}%`;
          p.style.height = '100%';
          p.style.minWidth = '200px';
        });
        resizers.forEach(r => {
          r.style.width = '8px';
          r.style.height = '100%';
          r.style.cursor = 'col-resize';
        });
      }
    }

    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
    window.addEventListener('resize', () => {
      if (state.isSplitScreen) {
        adjustSplitLayout();
      }
    });

    // è‡ªåŠ¨æŸ¥è¯¢æ‰€æœ‰AI
    function autoQueryAllAis() {
      const question = document.getElementById('questionInput').value.trim();
      
      if (!question) {
        showNotification('è¯·è¾“å…¥é—®é¢˜å†…å®¹', 'warning');
        return;
      }
      
      if (state.selectedAIs.size === 0) {
        showNotification('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªAI', 'warning');
        return;
      }
      
      const allAIs = getAllAIs();
      const selectedAis = allAIs.filter(ai => state.selectedAIs.has(ai.id));
      
      // å¦‚æœåœ¨åˆ†å±æ¨¡å¼ä¸­ï¼Œå°†é—®é¢˜å‘é€åˆ°æ¯ä¸ªåˆ†å±
      if (state.isSplitScreen && state.splitPanels.length > 0) {
        selectedAis.forEach((ai, index) => {
          if (index < state.splitPanels.length) {
            const panel = state.splitPanels[index];
            openAiWebsite(ai.url, ai.name, panel.id);
            
            // å°è¯•å‘é€é—®é¢˜
            setTimeout(() => {
              try {
                const frame = document.getElementById(`splitFrame${panel.id}`);
                if (frame && frame.contentWindow) {
                  frame.contentWindow.postMessage({
                    type: 'AI_QUESTION',
                    question: question
                  }, '*');
                }
              } catch (e) {
                // å¿½ç•¥é”™è¯¯
              }
            }, 1000);
          }
        });
      } else {
        // åœ¨ä¸»çª—å£æ‰“å¼€ç¬¬ä¸€ä¸ªAI
        const firstAi = selectedAis[0];
        openAiWebsite(firstAi.url, firstAi.name);
        
        // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€å…¶ä»–AI
        for (let i = 1; i < selectedAis.length; i++) {
          setTimeout(() => {
            const win = window.open(selectedAis[i].url, `ai_query_${selectedAis[i].id}`);
            
            // å°è¯•å‘é€é—®é¢˜ï¼ˆéœ€è¦ç”¨æˆ·æ‰‹åŠ¨åŒæ„å¼¹å‡ºçª—å£ï¼‰
            if (win) {
              setTimeout(() => {
                try {
                  win.postMessage({
                    type: 'AI_QUESTION',
                    question: question
                  }, '*');
                } catch (e) {
                  // å¿½ç•¥é”™è¯¯
                }
              }, 1500);
            }
          }, i * 800);
        }
      }
      
      // å¤åˆ¶é—®é¢˜åˆ°å‰ªè´´æ¿
      copyToClipboard(question);
      
      showNotification(`å·²å‘ ${selectedAis.length} ä¸ªAIå‘é€é—®é¢˜ï¼Œé—®é¢˜å·²å¤åˆ¶åˆ°å‰ªè´´æ¿`, 'success');
    }

    // æ¯”è¾ƒAIç­”æ¡ˆ
    function compareAiAnswers() {
      const question = document.getElementById('questionInput').value.trim();
      
      if (!question) {
        showNotification('è¯·è¾“å…¥é—®é¢˜å†…å®¹', 'warning');
        return;
      }
      
      const allAIs = getAllAIs();
      const selectedAis = allAIs.filter(ai => state.selectedAIs.has(ai.id));
      
      if (selectedAis.length < 2) {
        showNotification('è¯·è‡³å°‘é€‰æ‹©2ä¸ªAIè¿›è¡Œæ¯”è¾ƒ', 'warning');
        return;
      }
      
      // ç”Ÿæˆæ¯”è¾ƒæŠ¥å‘Š
      let comparison = `# AIç­”æ¡ˆå¯¹æ¯”æŠ¥å‘Š\n\n`;
      comparison += `**é—®é¢˜:** ${question}\n\n`;
      comparison += `**å¯¹æ¯”æ—¶é—´:** ${new Date().toLocaleString()}\n\n`;
      comparison += `**å‚ä¸å¯¹æ¯”çš„AI (${selectedAis.length}ä¸ª):**\n`;
      
      selectedAis.forEach((ai, index) => {
        comparison += `${index + 1}. ${ai.name} (${ai.category})\n`;
      });
      
      comparison += `\n## æ¨¡æ‹Ÿå›ç­”å¯¹æ¯”\n\n`;
      
      // ä¸ºæ¯ä¸ªAIç”Ÿæˆæ¨¡æ‹Ÿå›ç­”
      selectedAis.forEach((ai, index) => {
        const responses = [
          `æ ¹æ®æˆ‘çš„åˆ†æï¼Œ${question} è¿™ä¸ªé—®é¢˜æ¶‰åŠå¤šä¸ªæ–¹é¢...`,
          `æˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒåœ¨äº... ${ai.name} çš„å›ç­”æ˜¯åŸºäºæœ€æ–°çš„æ•°æ®å’Œæ¨¡å‹è®­ç»ƒã€‚`,
          `ä»${ai.category}çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥è¿™æ ·ç†è§£...`,
          `æˆ‘çš„å›ç­”å¯èƒ½ä¸å…¶ä»–AIæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºæˆ‘çš„è®­ç»ƒæ•°æ®å’Œç®—æ³•æœ‰æ‰€åŒºåˆ«...`
        ];
        
        const response = responses[index % responses.length];
        comparison += `### ${ai.icon} ${ai.name}\n`;
        comparison += `**ç±»åˆ«:** ${ai.category}\n\n`;
        comparison += `${response}\n\n`;
        comparison += `---\n\n`;
      });
      
      comparison += `## æ€»ç»“\n\n`;
      comparison += `- ä¸åŒAIçš„å›ç­”ä¾§é‡ç‚¹ä¸åŒ\n`;
      comparison += `- é€šç”¨AIé€šå¸¸æä¾›æ›´å…¨é¢çš„å›ç­”\n`;
      comparison += `- ä¸“ä¸šAIåœ¨å…¶é¢†åŸŸå†…å¯èƒ½æ›´ç²¾ç¡®\n`;
      comparison += `- å»ºè®®ç»¼åˆå¤šä¸ªAIçš„å›ç­”ä»¥è·å¾—æ›´å…¨é¢çš„ç†è§£\n`;
      
      // ä¿å­˜åˆ°ç¬”è®°
      document.getElementById('noteTitle').value = `AIç­”æ¡ˆå¯¹æ¯”: ${question.substring(0, 20)}...`;
      document.getElementById('noteContent').value = comparison;
      
      showNotification('AIç­”æ¡ˆå¯¹æ¯”æŠ¥å‘Šå·²ç”Ÿæˆï¼Œè¯·æŸ¥çœ‹ç¬”è®°åŒºåŸŸ', 'success');
    }

    // æ¨¡æ‹ŸAIå¯¹è¯
    function simulateAiChat() {
      const question = document.getElementById('questionInput').value.trim();
      
      if (!question) {
        showNotification('è¯·è¾“å…¥é—®é¢˜å†…å®¹', 'warning');
        return;
      }
      
      const allAIs = getAllAIs();
      const selectedAis = allAIs.filter(ai => state.selectedAIs.has(ai.id));
      
      if (selectedAis.length < 2) {
        showNotification('è¯·è‡³å°‘é€‰æ‹©2ä¸ªAIè¿›è¡Œå¯¹è¯', 'warning');
        return;
      }
      
      // æ¨¡æ‹ŸAIå¯¹è¯
      let conversation = `# AIå¯¹è¯æ¨¡æ‹Ÿ\n\n`;
      conversation += `**è¯é¢˜:** ${question}\n\n`;
      conversation += `**å‚ä¸AI:** ${selectedAis.map(ai => ai.name).join(', ')}\n\n`;
      conversation += `**å¯¹è¯å¼€å§‹:**\n\n`;
      
      // æ¯ä¸ªAIè½®æµå‘è¨€
      const rounds = 3; // å¯¹è¯è½®æ•°
      for (let round = 0; round < rounds; round++) {
        conversation += `### ç¬¬ ${round + 1} è½®\n\n`;
        
        selectedAis.forEach((ai, index) => {
          const responses = [
            `${ai.name}: æˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜çš„å…³é”®åœ¨äº...`,
            `${ai.name}: æˆ‘åŒæ„å‰ä¸€ä¸ªè§‚ç‚¹ï¼Œä½†æˆ‘æƒ³è¡¥å……ä¸€ç‚¹...`,
            `${ai.name}: ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹...`,
            `${ai.name}: æ ¹æ®æˆ‘çš„è®­ç»ƒæ•°æ®ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥è¿™æ ·ç†è§£...`,
            `${ai.name}: æˆ‘è§‰å¾—æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘...`
          ];
          
          const responseIndex = (round * selectedAis.length + index) % responses.length;
          conversation += `${ai.icon} ${responses[responseIndex]}\n\n`;
        });
      }
      
      conversation += `**å¯¹è¯ç»“æŸ**\n\n`;
      conversation += `---\nå¯¹è¯æ¨¡æ‹Ÿå®Œæˆäº ${new Date().toLocaleString()}`;
      
      document.getElementById('noteTitle').value = `AIå¯¹è¯: ${question.substring(0, 20)}...`;
      document.getElementById('noteContent').value = conversation;
      
      showNotification('AIå¯¹è¯å·²ç”Ÿæˆï¼Œè¯·æŸ¥çœ‹ç¬”è®°åŒºåŸŸ', 'success');
    }

    // è¿è¡Œä»£ç 
    function runCode() {
      const code = document.getElementById('codeEditor').value;
      const language = document.getElementById('codeLanguage').value;
      
      if (!code.trim()) {
        showNotification('è¯·è¾“å…¥ä»£ç ', 'warning');
        return;
      }
      
      let output = '';
      
      try {
        // ç®€å•çš„ä»£ç æ‰§è¡Œæ¨¡æ‹Ÿ
        if (language === 'javascript') {
          // å®‰å…¨åœ°æ‰§è¡ŒJavaScript
          const consoleLogs = [];
          const originalLog = console.log;
          console.log = (...args) => {
            consoleLogs.push(args.join(' '));
          };
          
          try {
            // ä½¿ç”¨Functionæ„é€ å‡½æ•°åˆ›å»ºå®‰å…¨æ‰§è¡Œç¯å¢ƒ
            const func = new Function(code);
            const result = func();
            
            if (result !== undefined) {
              consoleLogs.push(`è¿”å›å€¼: ${result}`);
            }
            
            output = consoleLogs.join('\n') || 'ä»£ç æ‰§è¡Œå®Œæˆï¼Œæ— è¾“å‡º';
          } catch (error) {
            output = `é”™è¯¯: ${error.message}`;
          } finally {
            console.log = originalLog;
          }
        } else {
          output = `è¯­è¨€ "${language}" çš„ä»£ç æ‰§è¡Œæ¨¡æ‹Ÿ\nï¼ˆåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨ç›¸åº”çš„ç¼–è¯‘å™¨/è§£é‡Šå™¨ï¼‰\n\nä»£ç å†…å®¹:\n${code}`;
        }
      } catch (error) {
        output = `æ‰§è¡Œé”™è¯¯: ${error.message}`;
      }
      
      document.getElementById('codeOutput').value = output;
    }

    // æ›´æ–°ä»»åŠ¡åˆ—è¡¨
    function updateTaskList() {
      const taskList = document.getElementById('taskList');
      
      if (state.tasks.length === 0) {
        taskList.innerHTML = `
          <div style="text-align:center; padding:20px; color:var(--muted);">
            <div style="font-size:24px; margin-bottom:8px;">âœ…</div>
            <div>æš‚æ— ä»»åŠ¡</div>
          </div>
        `;
        return;
      }
      
      let html = '';
      
      state.tasks.forEach((task, index) => {
        html += `
          <div class="task-item">
            <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} data-index="${index}">
            <div class="task-text ${task.completed ? 'task-completed' : ''}">${escapeHtml(task.text)}</div>
          </div>
        `;
      });
      
      taskList.innerHTML = html;
      
      // æ·»åŠ å¤é€‰æ¡†äº‹ä»¶
      taskList.querySelectorAll('.task-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
          const index = parseInt(e.target.dataset.index);
          state.tasks[index].completed = e.target.checked;
          saveData();
        });
      });
    }

    // æ·»åŠ ä»»åŠ¡
    function addTask() {
      const taskInput = document.getElementById('newTaskInput');
      const text = taskInput.value.trim();
      
      if (!text) {
        showNotification('è¯·è¾“å…¥ä»»åŠ¡å†…å®¹', 'warning');
        return;
      }
      
      state.tasks.unshift({
        text: text,
        completed: false,
        timestamp: new Date().toLocaleString()
      });
      
      taskInput.value = '';
      saveData();
      updateTaskList();
      showNotification('ä»»åŠ¡å·²æ·»åŠ ', 'success');
    }

    // æ¸…é™¤å·²å®Œæˆä»»åŠ¡
    function clearCompletedTasks() {
      state.tasks = state.tasks.filter(task => !task.completed);
      saveData();
      updateTaskList();
      showNotification('å·²æ¸…é™¤å·²å®Œæˆä»»åŠ¡', 'info');
    }

    // æ˜¾ç¤ºæ–‡æœ¬å·¥å…·
    function showTextTools() {
      const text = document.getElementById('noteContent').value || document.getElementById('questionInput').value;
      
      if (!text) {
        showNotification('è¯·åœ¨ç¬”è®°æˆ–é—®é¢˜æ¡†ä¸­è¾“å…¥æ–‡æœ¬', 'warning');
        return;
      }
      
      const charCount = text.length;
      const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
      const lineCount = text.split('\n').length;
      
      const stats = `# æ–‡æœ¬åˆ†ææŠ¥å‘Š\n\n`;
      stats += `**æ–‡æœ¬å†…å®¹:**\n${text.substring(0, 200)}${text.length > 200 ? '...' : ''}\n\n`;
      stats += `## ç»Ÿè®¡ä¿¡æ¯\n\n`;
      stats += `- å­—ç¬¦æ•°: ${charCount}\n`;
      stats += `- å•è¯æ•°: ${wordCount}\n`;
      stats += `- è¡Œæ•°: ${lineCount}\n`;
      stats += `- æ®µè½æ•°: ${text.split('\n\n').length}\n\n`;
      
      if (text.length > 50) {
        const words = text.toLowerCase().match(/\b\w+\b/g) || [];
        const wordFreq = {};
        words.forEach(word => {
          wordFreq[word] = (wordFreq[word] || 0) + 1;
        });
        
        const sortedWords = Object.entries(wordFreq)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 10);
        
        if (sortedWords.length > 0) {
          stats += `## è¯é¢‘åˆ†æ (å‰10)\n\n`;
          sortedWords.forEach(([word, count], index) => {
            stats += `${index + 1}. "${word}": ${count}æ¬¡\n`;
          });
        }
      }
      
      document.getElementById('noteTitle').value = 'æ–‡æœ¬åˆ†ææŠ¥å‘Š';
      document.getElementById('noteContent').value = stats;
      
      showNotification('æ–‡æœ¬åˆ†ææŠ¥å‘Šå·²ç”Ÿæˆï¼Œè¯·æŸ¥çœ‹ç¬”è®°åŒºåŸŸ', 'success');
    }

    // æ˜¾ç¤ºå¿«é€Ÿè®¡ç®—å™¨
    function showQuickCalculator() {
      const calculator = `# å¿«é€Ÿè®¡ç®—å™¨\n\n`;
      calculator += `## åŸºæœ¬è¿ç®—\n\n`;
      calculator += `- 1 + 2 * 3 = ${1 + 2 * 3}\n`;
      calculator += `- (1 + 2) * 3 = ${(1 + 2) * 3}\n`;
      calculator += `- 10 / 2 = ${10 / 2}\n`;
      calculator += `- 2çš„10æ¬¡æ–¹ = ${Math.pow(2, 10)}\n`;
      calculator += `- å¹³æ–¹æ ¹(16) = ${Math.sqrt(16)}\n\n`;
      
      calculator += `## å•ä½è½¬æ¢\n\n`;
      calculator += `### é•¿åº¦\n`;
      calculator += `- 1 è‹±é‡Œ = ${(1 * 1.609).toFixed(3)} å…¬é‡Œ\n`;
      calculator += `- 1 è‹±å°º = ${(1 * 0.305).toFixed(3)} ç±³\n\n`;
      
      calculator += `### é‡é‡\n`;
      calculator += `- 1 åƒå…‹ = ${(1 * 2.205).toFixed(3)} ç£…\n`;
      calculator += `- 1 ç£… = ${(1 * 0.454).toFixed(3)} åƒå…‹\n\n`;
      
      calculator += `### æ¸©åº¦\n`;
      calculator += `- 100Â°F = ${((100 - 32) * 5/9).toFixed(1)}Â°C\n`;
      calculator += `- 0Â°C = ${(0 * 9/5 + 32).toFixed(1)}Â°F\n\n`;
      
      calculator += `## å…¶ä»–è®¡ç®—\n\n`;
      calculator += `- å½“å‰æ—¶é—´æˆ³: ${Date.now()}\n`;
      calculator += `- éšæœºæ•°: ${Math.random().toFixed(4)}\n`;
      calculator += `- åœ†å‘¨ç‡Ï€: ${Math.PI.toFixed(6)}\n`;
      calculator += `- è‡ªç„¶å¸¸æ•°e: ${Math.E.toFixed(6)}\n\n`;
      
      calculator += `---\n`;
      calculator += `æç¤º: åœ¨JavaScriptæ§åˆ¶å°ä¸­å¯ä»¥è¿›è¡Œæ›´å¤æ‚çš„è®¡ç®—\n`;
      calculator += `ä¾‹å¦‚: Math.sin(Math.PI/2) = ${Math.sin(Math.PI/2).toFixed(4)}`;
      
      document.getElementById('noteTitle').value = 'å¿«é€Ÿè®¡ç®—å™¨';
      document.getElementById('noteContent').value = calculator;
      
      showNotification('è®¡ç®—å™¨å·²ç”Ÿæˆï¼Œè¯·æŸ¥çœ‹ç¬”è®°åŒºåŸŸ', 'success');
    }

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    function updateStats() {
      const allAIs = getAllAIs();
      document.getElementById('aiCount').textContent = allAIs.length;
      document.getElementById('queryCount').textContent = state.queryCount;
      document.getElementById('noteCount').textContent = state.notes.length;
      
      // è®¡ç®—ä¼šè¯æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
      const now = new Date();
      const diffMs = now - state.sessionStartTime;
      const diffMins = Math.floor(diffMs / 60000);
      document.getElementById('sessionTime').textContent = diffMins;
    }

    // åŠ è½½æ•°æ®
    function loadData() {
      try {
        const savedNotes = localStorage.getItem('aiNotes');
        const savedChatHistory = localStorage.getItem('aiChatHistory');
        const savedTasks = localStorage.getItem('aiTasks');
        const savedQueryCount = localStorage.getItem('aiQueryCount');
        const savedCustomAIs = localStorage.getItem('aiCustomAIs');
        const savedSelectedAIs = localStorage.getItem('aiSelectedAIs');
        
        if (savedNotes) state.notes = JSON.parse(savedNotes);
        if (savedChatHistory) state.chatHistory = JSON.parse(savedChatHistory);
        if (savedTasks) state.tasks = JSON.parse(savedTasks);
        if (savedQueryCount) state.queryCount = parseInt(savedQueryCount);
        if (savedCustomAIs) state.customAIs = JSON.parse(savedCustomAIs);
        if (savedSelectedAIs) state.selectedAIs = new Set(JSON.parse(savedSelectedAIs));
      } catch (e) {
        console.warn('æ— æ³•ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®:', e);
      }
    }

    // ä¿å­˜æ•°æ®
    function saveData() {
      try {
        localStorage.setItem('aiNotes', JSON.stringify(state.notes));
        localStorage.setItem('aiChatHistory', JSON.stringify(state.chatHistory));
        localStorage.setItem('aiTasks', JSON.stringify(state.tasks));
        localStorage.setItem('aiQueryCount', state.queryCount.toString());
        localStorage.setItem('aiCustomAIs', JSON.stringify(state.customAIs));
        localStorage.setItem('aiSelectedAIs', JSON.stringify(Array.from(state.selectedAIs)));
      } catch (e) {
        console.warn('æ— æ³•ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨:', e);
      }
    }

    // è¿”å›ä¸»ç•Œé¢
    function returnToMain() {
      showNotification('æ­£åœ¨è¿”å›ä¸»ç•Œé¢...', 'success');
      const before = location.href;
      if (window.history && window.history.length > 1) {
        try {
          history.back();
        } catch (e) {
          // ignore
        }
        setTimeout(() => {
          if (location.href === before) {
            location.href = 'index.html';
          }
        }, 400);
      } else {
        location.href = 'index.html';
      }
    }

    // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
    function showLoading(show) {
      document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
    }

    // æ˜¾ç¤ºé€šçŸ¥
    function showNotification(message, type = 'info') {
      // ç§»é™¤ä¹‹å‰çš„é€šçŸ¥
      document.querySelectorAll('.notification').forEach(notification => {
        notification.remove();
      });
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿
    function copyToClipboard(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      
      try {
        document.execCommand('copy');
        showNotification('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
      } catch (e) {
        console.warn('å¤åˆ¶å¤±è´¥:', e);
        showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'warning');
      }
      
      document.body.removeChild(textarea);
    }

    // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // åˆå§‹åŒ–åº”ç”¨
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>